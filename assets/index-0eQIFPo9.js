var Rt=Object.defineProperty;var St=(t,s,o)=>s in t?Rt(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o;var Ee=(t,s,o)=>St(t,typeof s!="symbol"?s+"":s,o);import{r,j as e}from"./react-xe4jsmfW.js";import{a as Dt}from"./react-dom-CDP_2C_w.js";import{B as Ot}from"./react-router-dom-DJdzfmKp.js";import{F as It,n as _,z as U}from"./react-hot-toast-BWCWS8kw.js";import{l as _t}from"./socket.io-client-BM-Eb1Rs.js";import{L as kt,a as Pe,b as Tt,c as At,R as Lt,d as Pt,e as Ft,A as Mt,f as Ut,P as tt,M as st,T as Ht,g as zt,B as Gt,h as Wt,F as $t,i as Bt,j as Jt,k as Vt,l as $e,m as Be,n as Yt,I as qt,G as Qt,o as Kt,p as Xt,q as Zt,r as es,s as ts,t as ss,u as Je,v as os,w as ns,x as rs}from"./react-icons-nsaY8Wvn.js";import{v as te}from"./uuid-CtRu48qb.js";import{u as ot,a as ke,b as nt,c as as,d as Ve}from"./react-router-eO3UNvOE.js";import{a as Fe}from"./axios-B9ygI19o.js";import{F as is}from"./file-saver-DXLm0zc3.js";import{J as ls}from"./jszip-BYW2XS47.js";import{M as cs}from"./react-markdown-Cuyo6ip9.js";import{h as ds,d as us}from"./react-syntax-highlighter-DMpjYQye.js";import{I as ms}from"./vscode-icons-js-DUdIxQfY.js";import{I as rt}from"./@iconify-INkOFpyZ.js";import{c as we}from"./classnames-Dty2DWCt.js";import{l as at}from"./lang-map-nLg5Kdxm.js";import{x as fs,a as ps,w as hs,b as xs,v as gs,t as bs,c as ys,d as ws,e as Es,s as vs,f as Ns,g as js,r as Cs,q as Rs,o as Ss,n as Ds,h as Os,m as Is,i as _s,j as ks,k as Ts,l as As,p as Ls,u as Ps,y as Fs,z as Ms,A as Us,B as Hs,C as zs,D as Gs,E as Ws,F as $s,G as Bs,H as Js,I as Vs,J as Ys,K as qs,L as Qs,M as Ks,N as Xs,O as Zs,P as eo,Q as to,R as so,S as oo,T as no,U as ro,V as ao}from"./@uiw-C3tmGjRq.js";import{A as it}from"./react-avatar-CEX1TIQS.js";import{S as io}from"./react-split-s72OsX8P.js";import{M as De}from"./react-tooltip-DN-mCcUm.js";import"./core-js-C7DbFKwg.js";import{u as lo}from"./@tldraw-p3oJsSm0.js";import"./lodash.throttle-yuuEgjvB.js";import"./lodash.uniq-u0GOvbqz.js";import"./lodash.isequal-CX3c-88x.js";import"./idb-Bn1DMRyg.js";import{T as co}from"./tldraw-DKVnECBa.js";import"./lz-string-DQU_J7vJ.js";import"./hotkeys-js-BxEwhL3V.js";import{bQ as uo,bR as mo,E as Me,bj as Oe,bk as fo,bS as po,q as ho,B as xo,y as go,x as bo,C as yo,M as wo,u as Eo,J as Ye,A as vo,I as No,z as jo,h as Ce,K as Co,j as Re}from"./@codemirror-D8nkFkXT.js";import{s as qe}from"./screenfull-DmVOzVZz.js";import"./charenc-CI8Jn5z4.js";import"./scheduler-CoSDG3-6.js";import"./@remix-run-BpfYDNJ8.js";import"./goober-wofAfydu.js";import"./engine.io-client-CfqhKr8h.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";import"./devlop-Cl3hj7Sz.js";import"./unified-BVfCCR4t.js";import"./bail-FqpXQuLt.js";import"./extend-D1C0LVzC.js";import"./is-plain-obj-C1gvLhAf.js";import"./trough-B_b8ryxu.js";import"./vfile-DoIswyph.js";import"./vfile-message-Ezj_CYSE.js";import"./unist-util-stringify-position-Ch_qCilz.js";import"./remark-parse-C8jcMe6G.js";import"./mdast-util-from-markdown-CgCUhJTR.js";import"./micromark-util-decode-numeric-character-reference-CNs1qBpV.js";import"./micromark-util-decode-string-strjl-tx.js";import"./decode-named-character-reference-C3-224fz.js";import"./micromark-util-normalize-identifier-C9ANKk3v.js";import"./micromark-DhRKOnvZ.js";import"./micromark-util-combine-extensions-Bka6Sc1c.js";import"./micromark-util-chunked-DrRIdSP-.js";import"./micromark-factory-space-CA-Wq7KA.js";import"./micromark-util-character-Ch8j4vtg.js";import"./micromark-core-commonmark-CDnWrFBr.js";import"./micromark-util-classify-character-GCpR5yWH.js";import"./micromark-util-resolve-all-PQCKh0dx.js";import"./micromark-util-subtokenize-BC4BSQ9J.js";import"./micromark-factory-destination-CkgxUJuk.js";import"./micromark-factory-label-U15tx9Nh.js";import"./micromark-factory-title-reCpaPbc.js";import"./micromark-factory-whitespace-_v4v79HM.js";import"./micromark-util-html-tag-name-DbKNfynz.js";import"./mdast-util-to-string-C_aolqmU.js";import"./remark-rehype-lIbojaYD.js";import"./mdast-util-to-hast-C1lZlDm6.js";import"./@ungap--gfxRhYI.js";import"./micromark-util-sanitize-uri-WGc3xW3f.js";import"./unist-util-position-60F3QETU.js";import"./trim-lines-D8znQY54.js";import"./unist-util-visit-CWHsnU7X.js";import"./unist-util-visit-parents-DZMunsV6.js";import"./unist-util-is-BPZGFiMU.js";import"./hast-util-to-jsx-runtime-CPS_PIgD.js";import"./comma-separated-tokens-xMQ5YY98.js";import"./property-information-Bx45xMUt.js";import"./space-separated-tokens-DD3iYX1K.js";import"./style-to-js-BPjnuCk7.js";import"./style-to-object-Cg2xzs12.js";import"./inline-style-parser-BlqBsVO4.js";import"./hast-util-whitespace-D4Wp6AEg.js";import"./estree-util-is-identifier-name-BgBfM8ME.js";import"./html-url-attributes-D46m5wfe.js";import"./@babel-pqmwtNTb.js";import"./refractor-De9CcUcl.js";import"./hastscript-Cxyc55ZY.js";import"./xtend-VQg9yHl6.js";import"./hast-util-parse-selector-BXt8oe2z.js";import"./parse-entities-C6euGolz.js";import"./character-reference-invalid-AKrgFUtc.js";import"./is-decimal-Bg2oiju0.js";import"./is-hexadecimal-yh8m6GRc.js";import"./is-alphanumerical-_oBzrqVk.js";import"./is-alphabetical-BQ1fjZEF.js";import"./@lezer-Bc0n9ZzW.js";import"./@replit-Z3Y5JSVX.js";import"./colors-named-CSGyx1iI.js";import"./colors-named-hex-Db6HdBCI.js";import"./hsl-matcher-CyxH9sTP.js";import"./prop-types-yNpOvJnk.js";import"./is-retina-BzLP6e3E.js";import"./md5-d1KzqBq9.js";import"./crypt-C-Yx0DM0.js";import"./is-buffer-DMJNLjvk.js";import"./split.js-CPyVEc61.js";import"./@floating-ui-Dttr1Bto.js";import"./nanoid-vcSNLBTf.js";import"./@use-gesture-DOFCekvX.js";import"./eventemitter3-Dqjbdtcb.js";import"./@radix-ui-7FXfGXGO.js";import"./react-remove-scroll-DaQnJUT6.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-wXCc6S34.js";import"./react-style-singleton-C2vgJe_j.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-DjRnOWoj.js";import"./use-callback-ref-B2lVNl4n.js";import"./aria-hidden-DvXkyWUv.js";import"./canvas-size-By42e4U-.js";import"./crelt-C8TCjufn.js";import"./@marijn-DXwl3gUT.js";import"./style-mod-Bs6eFhZE.js";import"./w3c-keyname-Vcq4gwWv.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function o(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(a){if(a.ep)return;a.ep=!0;const l=o(a);fetch(a.href,l)}})();function lt(){return{setItem:(n,a)=>{localStorage.setItem(n,a)},getItem:n=>localStorage.getItem(n),removeItem:n=>{localStorage.removeItem(n)}}}const ct=r.createContext(null),Ne=()=>{const t=r.useContext(ct);if(!t)throw new Error("useSettings must be used within a SettingContextProvider");return t},ae={theme:"Dracula",language:"Javascript",fontSize:16,fontFamily:"Space Mono",showGitHubCorner:!0};function Ro({children:t}){const{getItem:s}=lt(),o=JSON.parse(s("settings")||"{}"),n=o.theme!==void 0?o.theme:ae.theme,a=o.language!==void 0?o.language:ae.language,l=o.fontSize!==void 0?o.fontSize:ae.fontSize,d=o.fontFamily!==void 0?o.fontFamily:ae.fontFamily,u=o.showGitHubCorner!==void 0?o.showGitHubCorner:ae.showGitHubCorner,[c,p]=r.useState(n),[x,m]=r.useState(a),[f,g]=r.useState(l),[i,y]=r.useState(d),[v,R]=r.useState(u),k=()=>{p(ae.theme),m(ae.language),g(ae.fontSize),y(ae.fontFamily),R(ae.showGitHubCorner)};return r.useEffect(()=>{const j={theme:c,language:x,fontSize:f,fontFamily:i,showGitHubCorner:v};localStorage.setItem("settings",JSON.stringify(j))},[c,x,f,i,v]),e.jsx(ct.Provider,{value:{theme:c,setTheme:p,language:x,setLanguage:m,fontSize:f,setFontSize:g,fontFamily:i,setFontFamily:y,showGitHubCorner:v,setShowGitHubCorner:R,resetSettings:k},children:t})}function fe(){const[t,s]=r.useState({width:window.innerWidth,height:window.innerHeight}),[o,n]=r.useState(window.innerWidth<768);return r.useEffect(()=>{const a=()=>{s({width:window.innerWidth,height:window.innerHeight}),n(window.innerWidth<768)};return window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}},[]),{...t,isMobile:o}}function So(){const{showGitHubCorner:t}=Ne(),{width:s}=fe();return e.jsx("a",{href:"https://github.com/smshagor-dev",className:"github-corner","aria-label":"View source on GitHub",target:"_blank",rel:"noreferrer",style:{display:t&&s>640?"block":"none"},children:e.jsx("svg",{width:"150",height:"100",viewBox:"0 0 250 250",className:"absolute right-0 top-0 z-10 border-none bg-primary text-gray-900 dark:text-gray-100","aria-hidden":"true",style:{color:"#151513",transform:"rotate(45deg) translate(12%,-80%) scale(0.8)"},children:e.jsxs("g",{style:{transform:"rotate(-45deg) translate(0%,50%)",transformOrigin:"bottom"},children:[e.jsx("path",{d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2",fill:"currentColor",style:{transformOrigin:"130px 106px"},className:"octo-arm"}),e.jsx("path",{d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z",fill:"currentColor",className:"octo-body"})]})})})}function Do(){return e.jsx(It,{position:"top-right"})}var le=(t=>(t.CODING="coding",t.DRAWING="drawing",t))(le||{}),ve=(t=>(t.OFFLINE="offline",t.ONLINE="online",t))(ve||{}),F=(t=>(t.INITIAL="initial",t.CONNECTING="connecting",t.ATTEMPTING_JOIN="attempting-join",t.JOINED="joined",t.CONNECTION_FAILED="connection-failed",t.DISCONNECTED="disconnected",t.BANNED="banned",t))(F||{});const dt=r.createContext(null),Q=()=>{const t=r.useContext(dt);if(t===null)throw new Error("useAppContext must be used within a AppContextProvider");return t};function Oo({children:t}){const[s,o]=r.useState([]),[n,a]=r.useState(F.INITIAL),[l,d]=r.useState({username:"",roomId:""}),[u,c]=r.useState(le.CODING),[p,x]=r.useState(null),[m,f]=r.useState(null),[g,i]=r.useState({});return e.jsx(dt.Provider,{value:{users:s,setUsers:o,currentUser:l,setCurrentUser:d,status:n,setStatus:a,activityState:u,setActivityState:c,drawingData:p,setDrawingData:x,roomId:m,setRoomId:f,userAudioStreams:g,setUserAudioStreams:i},children:t})}var h=(t=>(t.JOIN_REQUEST="join-request",t.JOIN_ACCEPTED="join-accepted",t.USER_JOINED="user-joined",t.USER_DISCONNECTED="user-disconnected",t.SYNC_FILE_STRUCTURE="sync-file-structure",t.DIRECTORY_CREATED="directory-created",t.DIRECTORY_UPDATED="directory-updated",t.DIRECTORY_RENAMED="directory-renamed",t.DIRECTORY_DELETED="directory-deleted",t.FILE_CREATED="file-created",t.FILE_UPDATED="file-updated",t.FILE_RENAMED="file-renamed",t.FILE_DELETED="file-deleted",t.USER_OFFLINE="offline",t.USER_ONLINE="online",t.SEND_MESSAGE="send-message",t.RECEIVE_MESSAGE="receive-message",t.TYPING_START="typing-start",t.TYPING_PAUSE="typing-pause",t.CURSOR_MOVE="cursor-move",t.USERNAME_EXISTS="username-exists",t.REQUEST_DRAWING="request-drawing",t.SYNC_DRAWING="sync-drawing",t.DRAWING_UPDATE="drawing-update",t.PASSWORD_REQUIRED="password-required",t.PASSWORD_INCORRECT="password-incorrect",t.ROOM_INFO_REQUEST="room-info-request",t.ROOM_INFO_RESPONSE="room-info-response",t.CHECK_ROOM_PASSWORD="check-room-password",t.PASSWORD_VALID="password-valid",t.ERROR="error",t.ROOM_CREATED="room-created",t.CREATE_ROOM="create-room",t.FILE_STRUCTURE_LOADED="file-structure-loaded",t.FILE_CONTENT_LOADED="file-content-loaded",t.LOAD_FILE_STRUCTURE="load-file-structure",t.LOAD_FILE_CONTENT="load-file-content",t.LOAD_CHAT_HISTORY="load_chat_history",t.CHAT_HISTORY_LOADED="chat_history_loaded",t.EDIT_ROOM_REQUEST="EDIT_ROOM_REQUEST",t.EDIT_ROOM_RESPONSE="EDIT_ROOM_RESPONSE",t.ROOM_OWNER_CHECK="ROOM_OWNER_CHECK",t.ROOM_OWNER_RESPONSE="ROOM_OWNER_RESPONSE",t.ROOM_UPDATED="ROOM_UPDATED",t.JOIN_PENDING="JOIN_PENDING",t.GET_ROOM_USERS="GET_ROOM_USERS",t.ROOM_USERS_LIST="ROOM_USERS_LIST",t.UPDATE_USER_STATUS="UPDATE_USER_STATUS",t.USER_STATUS_UPDATED="USER_STATUS_UPDATED",t.USER_BANNED_STATUS="USER_BANNED_STATUS",t.WEBRTC_OFFER="WEBRTC_OFFER",t.WEBRTC_ANSWER="WEBRTC_ANSWER",t.WEBRTC_ICE_CANDIDATE="WEBRTC_ICE_CANDIDATE",t.USER_AUDIO_TOGGLED="USER_AUDIO_TOGGLED",t.REMOTE_AUDIO_STREAM_ADDED="REMOTE_AUDIO_STREAM_ADDED",t))(h||{});const ut=r.createContext(null),K=()=>{const t=r.useContext(ut);if(!t)throw new Error("useSocket must be used within a SocketProvider");return t},Io="https://cloud.coderpoint.ru",_o=({children:t})=>{const{users:s,setUsers:o,setStatus:n,setCurrentUser:a,drawingData:l,setDrawingData:d}=Q(),u=r.useMemo(()=>_t(Io,{reconnectionAttempts:2}),[]),c=r.useCallback(i=>{console.log("socket error",i),n(F.CONNECTION_FAILED),_.dismiss(),_.error("Failed to connect to the server")},[n]),p=r.useCallback(()=>{_.dismiss(),n(F.INITIAL),_.error("The username you chose already exists in the room. Please choose a different username.")},[n]),x=r.useCallback(({user:i,users:y})=>{a(i),o(y),_.dismiss(),n(F.JOINED),y.length>1&&_.loading("Syncing data, please wait...")},[a,n,o]),m=r.useCallback(({user:i})=>{_.success(`${i.username} left the room`),o(s.filter(y=>y.username!==i.username))},[o,s]),f=r.useCallback(({socketId:i})=>{u.emit(h.SYNC_DRAWING,{socketId:i,drawingData:l})},[l,u]),g=r.useCallback(({drawingData:i})=>{d(i)},[d]);return r.useEffect(()=>(u.on("connect_error",c),u.on("connect_failed",c),u.on(h.USERNAME_EXISTS,p),u.on(h.JOIN_ACCEPTED,x),u.on(h.USER_DISCONNECTED,m),u.on(h.REQUEST_DRAWING,f),u.on(h.SYNC_DRAWING,g),()=>{u.off("connect_error"),u.off("connect_failed"),u.off(h.USERNAME_EXISTS),u.off(h.JOIN_ACCEPTED),u.off(h.USER_DISCONNECTED),u.off(h.REQUEST_DRAWING),u.off(h.SYNC_DRAWING)}),[g,c,x,f,m,p,o,u]),e.jsx(ut.Provider,{value:{socket:u},children:t})},mt=r.createContext(null),Ue=()=>{const t=r.useContext(mt);if(!t)throw new Error("useChatRoom must be used within a ChatContextProvider");return t};function ko({children:t}){const{socket:s}=K(),{currentUser:o}=Q(),[n,a]=r.useState([]),[l,d]=r.useState(!1),[u,c]=r.useState(0),[p,x]=r.useState(!1);return r.useEffect(()=>{if(!s)return;const m=()=>{console.log("User joined room, loading chat history..."),x(!0)};return s.on(h.JOIN_ACCEPTED,m),()=>{s.off(h.JOIN_ACCEPTED,m)}},[s]),r.useEffect(()=>{if(!s||!p){console.log("Socket not ready or user not joined room yet");return}return console.log("Requesting chat history..."),s.emit(h.LOAD_CHAT_HISTORY),s.on(h.CHAT_HISTORY_LOADED,({messages:m})=>{console.log("Received chat history:",(m==null?void 0:m.length)||0,"messages"),m&&Array.isArray(m)?a(m):(console.log("No chat history or invalid format"),a([]))}),()=>{console.log("Cleanup: removing CHAT_HISTORY_LOADED listener"),s.off(h.CHAT_HISTORY_LOADED)}},[s,p]),r.useEffect(()=>{if(!s)return;const m=({message:f})=>{console.log("New message received:",f),a(g=>[...g,f]),d(!0)};return s.on(h.RECEIVE_MESSAGE,m),()=>{s.off(h.RECEIVE_MESSAGE)}},[s]),r.useEffect(()=>{o!=null&&o.username||(a([]),x(!1))},[o]),e.jsx(mt.Provider,{value:{messages:n,setMessages:a,isNewMessage:l,setIsNewMessage:d,lastScrollHeight:u,setLastScrollHeight:c},children:t})}function To(t){const s=new Date(t);let o=s.getHours();const n=String(s.getMinutes()).padStart(2,"0"),a=o>=12?"PM":"AM";return o=o%12,o=o||12,`${o}:${n} ${a}`}function Ao(){const{currentUser:t}=Q(),{socket:s}=K(),{setMessages:o}=Ue(),n=r.useRef(null),a=l=>{var u;l.preventDefault();const d=(u=n.current)==null?void 0:u.value.trim();if(d&&d.length>0){const c={id:te(),message:d,username:t.username,timestamp:To(new Date().toISOString())};s.emit(h.SEND_MESSAGE,{message:c}),o(p=>[...p,c]),n.current&&(n.current.value="")}};return e.jsxs("form",{onSubmit:a,className:"flex justify-between rounded-md border border-primary",children:[e.jsx("input",{type:"text",className:"w-full flex-grow rounded-md border-none bg-dark p-2 outline-none",placeholder:"Enter a message...",ref:n}),e.jsx("button",{className:"flex items-center justify-center rounded-r-md  bg-primary p-2 text-black",type:"submit",children:e.jsx(kt,{size:24})})]})}function Lo(){const{messages:t,isNewMessage:s,setIsNewMessage:o,lastScrollHeight:n,setLastScrollHeight:a}=Ue(),{currentUser:l}=Q(),d=r.useRef(null),u=c=>{const p=c.target;a(p.scrollTop)};return r.useEffect(()=>{d.current&&(d.current.scrollTop=d.current.scrollHeight)},[t]),r.useEffect(()=>{s&&o(!1),d.current&&(d.current.scrollTop=n)},[s,o,n]),e.jsx("div",{className:"flex-grow overflow-auto rounded-md bg-darkHover p-2",ref:d,onScroll:u,children:t.map((c,p)=>e.jsxs("div",{className:"mb-2 w-[80%] self-end break-words rounded-md bg-dark px-3 py-2"+(c.username===l.username?" ml-auto ":""),children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs text-primary",children:c.username}),e.jsx("span",{className:"text-xs text-white",children:c.timestamp})]}),e.jsx("p",{className:"py-1",children:c.message})]},p))})}function se(){const[t,s]=r.useState(!1),{height:o,isMobile:n}=fe(),[a,l]=r.useState(o);return r.useEffect(()=>{o<500&&n?(s(!0),l(o)):n?(s(!1),l(o-50)):(s(!1),l(o))},[o,n,a]),{viewHeight:a,minHeightReached:t}}const Po=()=>{const{viewHeight:t}=se(),{roomId:s}=ot();return e.jsxs("div",{className:"flex max-h-full min-h-[400px] w-full flex-col gap-2 p-4",style:{height:t},children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h1",{className:"view-title",children:["Group Chat -",s&&e.jsx("span",{className:"ml-2 text-xl text-gray-500",children:s})]})}),e.jsx(Lo,{}),e.jsx(Ao,{})]})},Fo="https://text.pollinations.ai",Mo=Fe.create({baseURL:Fo,headers:{"Content-Type":"application/json"}}),ft=r.createContext(null),Uo=()=>{const t=r.useContext(ft);if(t===null)throw new Error("useCopilot must be used within a CopilotContextProvider");return t},Ho=({children:t})=>{const[s,o]=r.useState(""),[n,a]=r.useState(""),[l,d]=r.useState(!1),u=async()=>{try{if(s.length===0){U.error("Please write a prompt");return}U.loading("Generating code..."),d(!0);const c=await Mo.post("/",{messages:[{role:"system",content:"You are a code generator copilot for project named Code Editor. Generate code based on the given prompt without any explanation. Return only the code, formatted in Markdown using the appropriate language syntax (e.g., js for JavaScript, py for Python). Do not include any additional text or explanations. If you don't know the answer, respond with 'I don't know'."},{role:"user",content:s}],model:"mistral",private:!0});if(c.data){U.success("Code generated successfully");const p=c.data;p&&a(p)}d(!1),U.dismiss()}catch(c){console.error(c),d(!1),U.dismiss(),U.error("Failed to generate the code")}};return e.jsx(ft.Provider,{value:{setInput:o,output:n,isRunning:l,generateCode:u},children:t})},zo=`function sayHi() {
  console.log("ðŸ‘‹ Hello world");
}

sayHi()`,Ae={name:"root",id:te(),type:"directory",children:[{id:te(),type:"file",name:"index.js",content:zo}]},pt=(t,s)=>{if(t.id===s&&t.type==="directory")return t;if(t.type==="directory"&&t.children)for(const o of t.children){const n=pt(o,s);if(n)return n}return null},Qe=(t,s)=>t.children?t.children.some(o=>o.name===s):!1,Go=(t,s)=>{const o=n=>{if(n.id===s)return n;if(n.children)for(const a of n.children){const l=o(a);if(l)return l}return null};return o(t)},ht=t=>{if(t.type==="directory"&&t.children){let s=t.children.filter(n=>n.type==="directory");const o=t.children.filter(n=>n.type==="file");s.sort((n,a)=>n.name.localeCompare(a.name)),s=s.map(n=>ht(n)),o.sort((n,a)=>n.name.localeCompare(a.name)),t.children=[...s.filter(n=>n.name.startsWith(".")),...s.filter(n=>!n.name.startsWith(".")),...o.filter(n=>n.name.startsWith(".")),...o.filter(n=>!n.name.startsWith("."))]}return t},xt=r.createContext(null),ce=()=>{const t=r.useContext(xt);if(!t)throw new Error("useFileSystem must be used within FileContextProvider");return t};function Wo({children:t}){const{socket:s}=K(),{setUsers:o,drawingData:n,roomId:a,setRoomId:l}=Q(),[d,u]=r.useState(Ae),c=d.children?d.children:[],[p,x]=r.useState(c),[m,f]=r.useState(p[0]),[g,i]=r.useState(new Set),[y,v]=r.useState(!1);r.useEffect(()=>{a&&!y&&(console.log("Loading files for room:",a),s.emit(h.LOAD_FILE_STRUCTURE,{roomId:a}),v(!0))},[a,y,s]),r.useEffect(()=>{a||(console.log("Room ID cleared, resetting file structure"),u(Ae),x([]),f(null),v(!1),i(new Set))},[a]),r.useEffect(()=>{const b=S=>{var C,D;console.log("Join accepted, setting roomId:",(C=S.user)==null?void 0:C.roomId),l(((D=S.user)==null?void 0:D.roomId)||null),v(!1)},N=S=>{console.log("Room created, setting roomId:",S.roomId),l(S.roomId||null),v(!1)};return s.on(h.JOIN_ACCEPTED,b),s.on(h.ROOM_CREATED,N),()=>{s.off(h.JOIN_ACCEPTED,b),s.off(h.ROOM_CREATED,N)}},[s,l]);const R=b=>{const N=S=>S.id===b?{...S,isOpen:!S.isOpen}:S.children?{...S,children:S.children.map(N)}:S;u(S=>N(S))},k=()=>{const b=N=>{var S;return{...N,isOpen:!1,children:(S=N.children)==null?void 0:S.map(b)}};u(N=>b(N))},j=r.useCallback((b,N,S=!0)=>{let C;typeof N=="string"?C={id:te(),name:N,type:"directory",children:[],isOpen:!1}:C=N,b||(b=d.id);const D=T=>T.id===b?{...T,children:[...T.children||[],C]}:T.children?{...T,children:T.children.map(D)}:T;return u(T=>D(T)),S&&s.emit(h.DIRECTORY_CREATED,{parentDirId:b,newDirectory:C}),C.id},[d.id,s]),A=r.useCallback((b,N,S=!0)=>{b||(b=d.id);const C=D=>D.id===b?{...D,children:N}:D.children?{...D,children:D.children.map(C)}:D;u(D=>C(D)),x([]),f(null),b===d.id&&(_.dismiss(),_.success("Files and folders updated")),S&&s.emit(h.DIRECTORY_UPDATED,{dirId:b,children:N})},[d.id,s]),H=r.useCallback((b,N,S=!0)=>{const C=T=>T.type==="directory"&&T.children?T.children.some(G=>G.type==="directory"&&G.name===N&&G.id!==b)?null:{...T,children:T.children.map(G=>{if(G.id===b)return{...G,name:N};if(G.type==="directory"){const de=C(G);return de!==null?de:G}else return G})}:T,D=C(d);return D===null?!1:(u(D),S&&s.emit(h.DIRECTORY_RENAMED,{dirId:b,newDirName:N}),!0)},[s,u,d]),Y=r.useCallback((b,N=!0)=>{const S=C=>{if(C.type==="directory"&&C.id===b)return null;if(C.children){const D=C.children.map(S).filter(T=>T!==null);return{...C,children:D}}else return C};u(C=>S(C)),N&&s.emit(h.DIRECTORY_DELETED,{dirId:b})},[s]),z=b=>{const N=Go(d,b);N&&(O((m==null?void 0:m.id)||"",(m==null?void 0:m.content)||""),p.some(S=>S.id===b)||x(S=>[...S,N]),x(S=>S.map(C=>C.id===(m==null?void 0:m.id)?{...C,content:m.content||""}:C)),f(N),N.type==="file"&&(!N.content||N.content==="")&&!g.has(b)&&(console.log("Requesting file content from server:",b),i(S=>new Set(S).add(b)),s.emit(h.LOAD_FILE_CONTENT,{fileId:b})))},$=b=>{if(b===(m==null?void 0:m.id)){O(m.id,m.content||"");const N=p.findIndex(S=>S.id===b);N!==-1&&p.length>1?N>0?f(p[N-1]):f(p[N+1]):f(null)}x(N=>N.filter(S=>S.id!==b))},V=r.useCallback((b,N,S=!0)=>{let C=1;b||(b=d.id);const D=pt(d,b);if(!D)throw new Error("Parent directory not found");let T;if(typeof N=="string"){let G=N,de=Qe(D,G);for(;de;)G=`${G.split(".")[0]}(${C}).${G.split(".")[1]}`,de=Qe(D,G),C++;T={id:te(),name:G,type:"file",content:""}}else T=N;const ge=G=>G.id===D.id?{...G,children:[...G.children||[],T],isOpen:!0}:G.children?{...G,children:G.children.map(ge)}:G;return u(G=>ge(G)),x(G=>[...G,T]),f(T),S&&s.emit(h.FILE_CREATED,{parentDirId:b,newFile:T}),T.id},[d,s]),O=r.useCallback((b,N)=>{const S=C=>C.type==="file"&&C.id===b?{...C,content:N}:C.children?{...C,children:C.children.map(S)}:C;u(C=>S(C)),p.some(C=>C.id===b)&&x(C=>C.map(D=>D.id===b?{...D,content:N}:D))},[p]),E=r.useCallback((b,N,S=!0)=>{const C=D=>D.type==="directory"&&D.children?{...D,children:D.children.map(T=>T.type==="file"&&T.id===b?{...T,name:N}:T)}:D;return u(D=>C(D)),x(D=>D.map(T=>T.id===b?{...T,name:N}:T)),b===(m==null?void 0:m.id)&&f(D=>D?{...D,name:N}:null),S&&s.emit(h.FILE_RENAMED,{fileId:b,newName:N}),!0},[m==null?void 0:m.id,s]),w=r.useCallback((b,N=!0)=>{const S=C=>{if(C.type==="directory"&&C.children){const D=C.children.map(T=>T.type==="directory"?S(T):T.id!==b?T:null).filter(T=>T!==null);return{...C,children:D}}else return C};u(C=>S(C)),p.some(C=>C.id===b)&&x(C=>C.filter(D=>D.id!==b)),(m==null?void 0:m.id)===b&&f(null),_.success("File deleted successfully"),N&&s.emit(h.FILE_DELETED,{fileId:b})},[m==null?void 0:m.id,p,s]),I=()=>{const b=new ls,N=(S,C="")=>{const D=C+S.name+(S.type==="directory"?"/":"");if(S.type==="file")b.file(D,S.content||"");else if(S.type==="directory"&&S.children)for(const T of S.children)N(T,D)};if(d.type==="directory"&&d.children)for(const S of d.children)N(S);b.generateAsync({type:"blob"}).then(S=>{is.saveAs(S,"download.zip")})},J=r.useCallback(({fileStructure:b})=>{console.log("Room file structure loaded from server:",b),u(b);const N=b.children?b.children.filter(S=>S.type==="file"):[];x(N),N.length>0?f(N[0]):f(null),i(new Set)},[]),M=r.useCallback(({fileId:b,content:N})=>{console.log("File content loaded from server:",b,N),i(C=>{const D=new Set(C);return D.delete(b),D});const S=C=>C.type==="file"&&C.id===b?{...C,content:N}:C.children?{...C,children:C.children.map(S)}:C;u(C=>S(C)),x(C=>C.map(D=>D.id===b?{...D,content:N}:D)),(m==null?void 0:m.id)===b&&f(C=>C?{...C,content:N}:null)},[m==null?void 0:m.id]);r.useEffect(()=>()=>{i(new Set)},[]),r.useEffect(()=>{s.emit(h.LOAD_FILE_STRUCTURE),console.log("Requested room file structure from server")},[s]),r.useEffect(()=>{a&&!y&&(console.log("Loading files for room:",a),s.emit(h.LOAD_FILE_STRUCTURE,{roomId:a}),v(!0))},[a,y,s]),r.useEffect(()=>()=>{i(new Set)},[]),r.useEffect(()=>{a||(console.log("Room ID cleared, resetting file structure"),u(Ae),x([]),f(null),v(!1),i(new Set))},[a]);const X=r.useCallback(({user:b})=>{_.success(`${b.username} joined the room`),s.emit(h.SYNC_FILE_STRUCTURE,{fileStructure:d,openFiles:p,activeFile:m,socketId:b.socketId}),s.emit(h.SYNC_DRAWING,{drawingData:n,socketId:b.socketId}),o(N=>[...N,b])},[m,n,d,p,o,s]),oe=r.useCallback(({fileStructure:b,openFiles:N,activeFile:S})=>{u(b),x(N),f(S),_.dismiss()},[]),ee=r.useCallback(({parentDirId:b,newDirectory:N})=>{j(b,N,!1)},[j]),ne=r.useCallback(({dirId:b,children:N})=>{A(b,N,!1)},[A]),pe=r.useCallback(({dirId:b,newName:N})=>{H(b,N,!1)},[H]),he=r.useCallback(({dirId:b})=>{Y(b,!1)},[Y]),me=r.useCallback(({parentDirId:b,newFile:N})=>{V(b,N,!1)},[V]),xe=r.useCallback(({fileId:b,newContent:N})=>{O(b,N),(m==null?void 0:m.id)===b&&f({...m,content:N})},[m,O]),L=r.useCallback(({fileId:b,newName:N})=>{E(b,N,!1)},[E]),re=r.useCallback(({fileId:b})=>{w(b,!1)},[w]);return r.useEffect(()=>(s.once(h.SYNC_FILE_STRUCTURE,oe),s.on(h.USER_JOINED,X),s.on(h.DIRECTORY_CREATED,ee),s.on(h.DIRECTORY_UPDATED,ne),s.on(h.DIRECTORY_RENAMED,pe),s.on(h.DIRECTORY_DELETED,he),s.on(h.FILE_CREATED,me),s.on(h.FILE_UPDATED,xe),s.on(h.FILE_RENAMED,L),s.on(h.FILE_DELETED,re),s.on(h.FILE_STRUCTURE_LOADED,J),s.on(h.FILE_CONTENT_LOADED,M),()=>{s.off(h.USER_JOINED),s.off(h.DIRECTORY_CREATED),s.off(h.DIRECTORY_UPDATED),s.off(h.DIRECTORY_RENAMED),s.off(h.DIRECTORY_DELETED),s.off(h.FILE_CREATED),s.off(h.FILE_UPDATED),s.off(h.FILE_RENAMED),s.off(h.FILE_DELETED),s.off(h.FILE_STRUCTURE_LOADED),s.off(h.FILE_CONTENT_LOADED)}),[ee,he,pe,ne,me,re,L,oe,xe,X,J,M,s]),e.jsx(xt.Provider,{value:{fileStructure:d,openFiles:p,activeFile:m,setActiveFile:f,closeFile:$,toggleDirectory:R,collapseDirectories:k,createDirectory:j,updateDirectory:A,renameDirectory:H,deleteDirectory:Y,openFile:z,createFile:V,updateFileContent:O,renameFile:E,deleteFile:w,downloadFilesAndFolders:I},children:t})}function $o(){const{socket:t}=K(),{viewHeight:s}=se(),{generateCode:o,output:n,isRunning:a,setInput:l}=Uo(),{activeFile:d,updateFileContent:u,setActiveFile:c}=ce(),p=async()=>{try{const f=n.replace(/```[\w]*\n?/g,"").trim();await navigator.clipboard.writeText(f),U.success("Output copied to clipboard")}catch(f){U.error("Unable to copy output to clipboard"),console.log(f)}},x=()=>{if(d){const g=`${d.content?`${d.content}
`:""}${n.replace(/```[\w]*\n?/g,"").trim()}`;u(d.id,g),c({...d,content:g}),U.success("Code pasted successfully"),t.emit(h.FILE_UPDATED,{fileId:d.id,newContent:g})}},m=()=>{if(d){if(!confirm("Are you sure you want to replace the code in the file?"))return;const g=n.replace(/```[\w]*\n?/g,"").trim();u(d.id,g),c({...d,content:g}),U.success("Code replaced successfully"),t.emit(h.FILE_UPDATED,{fileId:d.id,newContent:g})}};return e.jsxs("div",{className:"flex max-h-full min-h-[400px] w-full flex-col gap-2 p-4",style:{height:s},children:[e.jsx("h1",{className:"view-title",children:"Copilot"}),e.jsx("textarea",{className:"min-h-[120px] w-full rounded-md border-none bg-darkHover p-2 text-white outline-none",placeholder:"What code do you want to generate?",onChange:f=>l(f.target.value)}),e.jsx("button",{className:"mt-1 flex w-full justify-center rounded-md bg-primary p-2 font-bold text-black outline-none disabled:cursor-not-allowed disabled:opacity-50",onClick:o,disabled:a,children:a?"Generating...":"Generate Code"}),n&&e.jsxs("div",{className:"flex justify-end gap-4 pt-2",children:[e.jsx("button",{title:"Copy Output",onClick:p,children:e.jsx(Pe,{size:18,className:"cursor-pointer text-white"})}),e.jsx("button",{title:"Replace code in file",onClick:m,children:e.jsx(Tt,{size:18,className:"cursor-pointer text-white"})}),e.jsx("button",{title:"Paste code in file",onClick:x,children:e.jsx(At,{size:18,className:"cursor-pointer text-white"})})]}),e.jsx("div",{className:"h-full rounded-lg w-full overflow-y-auto p-0",children:e.jsx(cs,{components:{code({inline:f,className:g,children:i,...y}){const v=/language-(\w+)/.exec(g||""),R=v?v[1]:"javascript";return f?e.jsx("code",{className:g,...y,children:i}):e.jsx(ds,{style:us,language:R,PreTag:"pre",className:"!m-0 !h-full !rounded-lg !bg-gray-900 !p-2",children:String(i).replace(/\n$/,"")})},pre({children:f}){return e.jsx("pre",{className:"h-full",children:f})}},children:n})})]})}const gt=({ref:t})=>{const[s,o]=r.useState(!1),[n,a]=r.useState({x:0,y:0});return r.useEffect(()=>{const l=t.current;if(!l)return;const d=()=>{o(!1)},u=p=>{t.current&&t.current.contains(p.target)?(o(!0),a({x:p.pageX,y:p.pageY})):o(!1)},c=p=>{p.preventDefault(),o(!0),a({x:p.pageX,y:p.pageY})};return l.addEventListener("contextmenu",c),document.addEventListener("click",d),document.addEventListener("contextmenu",u),()=>{l.removeEventListener("contextmenu",c),document.removeEventListener("click",d),document.removeEventListener("contextmenu",u)}},[t]),{menuOpen:s,setMenuOpen:o,coords:n,setCoords:a}},bt=t=>{var n;return`vscode-icons:${(n=ms.getIconForFile(t))==null?void 0:n.replace(/_/g,"-").split(".")[0]}`};function yt({id:t,preName:s,setEditing:o,type:n}){const[a,l]=r.useState(s||""),{renameFile:d,openFile:u,renameDirectory:c}=ce(),p=r.useRef(null),x=g=>{g.preventDefault(),g.stopPropagation();const i=n.charAt(0).toUpperCase()+n.slice(1);if(a==="")U.error(`${i} name cannot be empty`);else if(a.length>25)U.error(`${i} name cannot be longer than 25 characters`);else if(a===s)U.error(`${i} name cannot be the same as before`);else{const y=n==="directory"?c(t,a):d(t,a);y&&n==="file"&&u(t),y?o(!1):U.error(`${i} with same name already exists`)}},m=r.useCallback(g=>{var i;g.key==="Enter"?(i=p.current)==null||i.requestSubmit():g.key==="Escape"&&o(!1)},[o]),f=r.useCallback(g=>{const i=p.current;i&&!i.contains(g.target)&&o(!1)},[o]);return r.useEffect(()=>{const g=p.current;if(g)return g.focus(),g.addEventListener("keydown",m),document.addEventListener("keydown",f),document.addEventListener("click",f),()=>{g.removeEventListener("keydown",m),document.removeEventListener("keydown",f),document.removeEventListener("click",f)}},[f,m,o]),e.jsx("div",{className:"rounded-md",children:e.jsx("form",{onSubmit:x,ref:p,className:"flex w-full items-center gap-2 rounded-md",children:e.jsx("input",{type:"text",className:"w-full flex-grow rounded-sm bg-dark px-2 text-base text-white outline-none",autoFocus:!0,value:a,onChange:g=>l(g.target.value)})})})}function Bo(){const{fileStructure:t,createFile:s,createDirectory:o,collapseDirectories:n}=ce(),a=r.useRef(null),[l,d]=r.useState(null),{minHeightReached:u}=se(),c=f=>{a.current&&!a.current.contains(f.target)&&d(t.id)},p=()=>{const f=prompt("Enter file name");if(f){const g=l||t.id;s(g,f)}},x=()=>{const f=prompt("Enter directory name");if(f){const g=l||t.id;o(g,f)}},m=ht(t);return e.jsxs("div",{onClick:c,className:"flex flex-grow flex-col",children:[e.jsxs("div",{className:"view-title flex justify-between",children:[e.jsx("h2",{children:"Files"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:p,title:"Create File",children:e.jsx(Lt,{size:20})}),e.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:x,title:"Create Directory",children:e.jsx(Pt,{size:20})}),e.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:n,title:"Collapse All Directories",children:e.jsx(Ft,{size:20})})]})]}),e.jsx("div",{className:we("min-h-[200px] flex-grow overflow-auto pr-2 sm:min-h-0",{"h-[calc(80vh-170px)]":!u,"h-[85vh]":u}),ref:a,children:m.children&&m.children.map(f=>e.jsx(wt,{item:f,setSelectedDirId:d},f.id))})]})}function wt({item:t,setSelectedDirId:s}){const[o,n]=r.useState(!1),a=r.useRef(null),{coords:l,menuOpen:d,setMenuOpen:u}=gt({ref:a}),{deleteDirectory:c,toggleDirectory:p}=ce(),x=g=>{s(g),p(g)},m=g=>{g.stopPropagation(),u(!1),n(!0)},f=(g,i)=>{g.stopPropagation(),u(!1),confirm("Are you sure you want to delete directory?")&&c(i)};return r.useEffect(()=>{const g=a.current;if(!g)return;g.tabIndex=0;const i=y=>{y.stopPropagation(),y.key==="F2"&&n(!0)};return g.addEventListener("keydown",i),()=>{g.removeEventListener("keydown",i)}},[]),t.type==="file"?e.jsx(Jo,{item:t,setSelectedDirId:s}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"flex w-full items-center rounded-md px-2 py-1 hover:bg-darkHover",onClick:()=>x(t.id),ref:a,children:[t.isOpen?e.jsx(Mt,{size:24,className:"mr-2 min-w-fit"}):e.jsx(Ut,{size:24,className:"mr-2 min-w-fit"}),o?e.jsx(yt,{id:t.id,preName:t.name,type:"directory",setEditing:n}):e.jsx("p",{className:"flex-grow cursor-pointer overflow-hidden truncate",title:t.name,children:t.name})]}),e.jsx("div",{className:we({hidden:!t.isOpen},{block:t.isOpen},{"pl-4":t.name!=="root"}),children:t.children&&t.children.map(g=>e.jsx(wt,{item:g,setSelectedDirId:s},g.id))}),d&&e.jsx(Yo,{handleDeleteDirectory:f,handleRenameDirectory:m,id:t.id,left:l.x,top:l.y})]})}const Jo=({item:t,setSelectedDirId:s})=>{const{deleteFile:o,openFile:n}=ce(),[a,l]=r.useState(!1),{setIsSidebarOpen:d}=Te(),{isMobile:u}=fe(),{activityState:c,setActivityState:p}=Q(),x=r.useRef(null),{menuOpen:m,coords:f,setMenuOpen:g}=gt({ref:x}),i=R=>{a||(s(R),n(R),u&&d(!1),c===le.DRAWING&&p(le.CODING))},y=R=>{R.stopPropagation(),l(!0),g(!1)},v=(R,k)=>{R.stopPropagation(),g(!1),confirm("Are you sure you want to delete file?")&&o(k)};return r.useEffect(()=>{const R=x.current;if(!R)return;R.tabIndex=0;const k=j=>{j.stopPropagation(),j.key==="F2"&&l(!0)};return R.addEventListener("keydown",k),()=>{R.removeEventListener("keydown",k)}},[]),e.jsxs("div",{className:"flex w-full items-center rounded-md px-2 py-1 hover:bg-darkHover",onClick:()=>i(t.id),ref:x,children:[e.jsx(rt,{icon:bt(t.name),fontSize:22,className:"mr-2 min-w-fit"}),a?e.jsx(yt,{id:t.id,preName:t.name,type:"file",setEditing:l}):e.jsx("p",{className:"flex-grow cursor-pointer overflow-hidden truncate",title:t.name,children:t.name}),m&&e.jsx(Vo,{top:f.y,left:f.x,id:t.id,handleRenameFile:y,handleDeleteFile:v})]})},Vo=({top:t,left:s,id:o,handleRenameFile:n,handleDeleteFile:a})=>e.jsxs("div",{className:"absolute z-10 w-[150px] rounded-md border border-darkHover bg-dark p-1",style:{top:t,left:s},children:[e.jsxs("button",{onClick:n,className:"flex w-full items-center gap-2 rounded-md px-2 py-1 hover:bg-darkHover",children:[e.jsx(tt,{size:18}),"Rename"]}),e.jsxs("button",{onClick:l=>a(l,o),className:"flex w-full items-center gap-2 rounded-md px-2 py-1 text-danger hover:bg-darkHover",children:[e.jsx(st,{size:20}),"Delete"]})]}),Yo=({top:t,left:s,id:o,handleRenameDirectory:n,handleDeleteDirectory:a})=>e.jsxs("div",{className:"absolute z-10 w-[150px] rounded-md border border-darkHover bg-dark p-1",style:{top:t,left:s},children:[e.jsxs("button",{onClick:n,className:"flex w-full items-center gap-2 rounded-md px-2 py-1 hover:bg-darkHover",children:[e.jsx(tt,{size:18}),"Rename"]}),e.jsxs("button",{onClick:l=>a(l,o),className:"flex w-full items-center gap-2 rounded-md px-2 py-1 text-danger hover:bg-darkHover",children:[e.jsx(st,{size:20}),"Delete"]})]});function qo(){const{downloadFilesAndFolders:t,updateDirectory:s}=ce(),{viewHeight:o}=se(),{minHeightReached:n}=se(),[a,l]=r.useState(!1),d=async()=>{try{if(l(!0),"showDirectoryPicker"in window){const i=await window.showDirectoryPicker();await x(i);return}if("webkitdirectory"in HTMLInputElement.prototype){const i=document.createElement("input");i.type="file",i.webkitdirectory=!0,i.onchange=async y=>{const v=y.target.files;if(v){const R=await f(v);s("",R)}},i.click();return}_.error("Your browser does not support directory selection.")}catch(i){console.error("Error opening directory:",i),_.error("Failed to open directory")}finally{l(!1)}},u=async()=>{try{l(!0);const i=document.createElement("input");i.type="file",i.multiple=!0,i.onchange=async y=>{const v=y.target.files;v&&v.length>0&&await c(v)},i.click()}catch(i){console.error("Error opening files:",i),_.error("Failed to open files")}finally{l(!1)}},c=async i=>{try{_.loading(`Processing ${i.length} file(s)...`);const y=[];for(let k=0;k<i.length;k++){const j=i[k],A={id:te(),name:j.name,type:"file",content:await g(j)};y.push(A)}const R=[...await p(),...y];s("",R),_.dismiss(),_.success(`Successfully added ${i.length} file(s)`)}catch(y){console.error("Error processing files:",y),_.error("Failed to process files")}},p=async()=>[],x=async i=>{try{_.loading("Getting files and folders...");const y=await m(i);s("",y),_.dismiss(),_.success("Directory loaded successfully")}catch(y){console.error("Error processing directory:",y),_.error("Failed to process directory")}},m=async i=>{const y=[],v=["node_modules",".git",".vscode",".next"];for await(const R of i.values())if(R.kind==="file"){const k=await R.getFile(),j={id:te(),name:R.name,type:"file",content:await g(k)};y.push(j)}else if(R.kind==="directory"){if(v.includes(R.name))continue;const k={id:te(),name:R.name,type:"directory",children:await m(R),isOpen:!1};y.push(k)}return y},f=async i=>{const y=[],v=["node_modules",".git",".vscode",".next"];for(let R=0;R<i.length;R++){const k=i[R],j=k.webkitRelativePath.split("/");if(!j.some(A=>v.includes(A)))if(j.length>1){const A=j.slice(0,-1).join("/");if(y.findIndex($=>$.name===A&&$.type==="directory")===-1){const $={id:te(),name:A,type:"directory",children:[],isOpen:!1};y.push($)}const Y={id:te(),name:k.name,type:"file",content:await g(k)},z=y.find($=>$.name===A&&$.type==="directory");z&&z.children&&z.children.push(Y)}else{const A={id:te(),name:k.name,type:"file",content:await g(k)};y.push(A)}}return y},g=async i=>{try{if(i.type.startsWith("text/")||i.type==="application/json"||i.name.match(/\.(txt|js|jsx|ts|tsx|css|html|json|xml|md|py|java|c|cpp|cs|php|rb|go|rs|sh|bat|ps1)$/i))return await i.text();const y=await i.arrayBuffer(),v=btoa(new Uint8Array(y).reduce((R,k)=>R+String.fromCharCode(k),""));return`data:${i.type};base64,${v}`}catch(y){return console.error(`Error reading file ${i.name}:`,y),`Binary file: ${i.name} (${Math.round(i.size/1024)}KB) - ${i.type||"Unknown type"}`}};return e.jsxs("div",{className:"flex select-none flex-col gap-1 px-4 py-2",style:{height:o,maxHeight:o},children:[e.jsx(Bo,{}),e.jsxs("div",{className:we("flex min-h-fit flex-col justify-end pt-2",{hidden:n}),children:[e.jsx("hr",{}),e.jsxs("button",{className:"mt-2 flex w-full justify-start rounded-md p-2 transition-all hover:bg-darkHover",onClick:d,disabled:a,children:[e.jsx(Ht,{className:"mr-2",size:24}),a?"Loading...":"Open Folder"]}),e.jsxs("button",{className:"flex w-full justify-start rounded-md p-2 transition-all hover:bg-darkHover",onClick:u,disabled:a,children:[e.jsx(zt,{className:"mr-2",size:24}),a?"Loading...":"Add Files"]}),e.jsxs("button",{className:"flex w-full justify-start rounded-md p-2 transition-all hover:bg-darkHover",onClick:t,children:[e.jsx(Gt,{className:"mr-2",size:22})," Download Code"]})]})]})}const Qo="https://emkc.org/api/v2/piston",Le=Fe.create({baseURL:Qo,headers:{"Content-Type":"application/json"}}),Ko="https://cloud.code-editor.ru/api",Xo=Fe.create({baseURL:Ko,headers:{"Content-Type":"application/json"},withCredentials:!0,timeout:3e4}),Et=r.createContext(null),Zo=()=>{const t=r.useContext(Et);if(t===null)throw new Error("useRunCode must be used within a RunCodeContextProvider");return t},en=({children:t})=>{const{activeFile:s}=ce(),[o,n]=r.useState(""),[a,l]=r.useState(""),[d,u]=r.useState(!1),[c,p]=r.useState([]),[x,m]=r.useState({language:"",version:"",aliases:[]});r.useEffect(()=>{(async()=>{var i,y;try{const v=await Le.get("/runtimes");p(v.data)}catch(v){U.error("Failed to fetch supported languages"),(i=v==null?void 0:v.response)!=null&&i.data&&console.error((y=v==null?void 0:v.response)==null?void 0:y.data)}})()},[]),r.useEffect(()=>{if(c.length===0||!(s!=null&&s.name))return;const g=s.name.split(".").pop();if(g){const i=at.languages(g),y=c.find(v=>v.aliases.includes(g)||i.includes(v.language.toLowerCase()));y&&m(y)}else m({language:"",version:"",aliases:[]})},[s==null?void 0:s.name,c]);const f=async()=>{var g;try{if(x)if(s)U.loading("Running code...");else return U.error("Please open a file to run the code");else return U.error("Please select a language to run the code");if(u(!0),x.language==="python"||x.aliases.includes("py"))try{console.log("Trying code-editor-cloud for Python execution");const i=await Xo.post("/execute.php",{code:s.content,language:"python",input:o});i.data.success?(l(i.data.output),console.log("Successfully executed using code-editor-cloud")):(l(i.data.error||"Execution failed"),console.log("code-editor-cloud returned error"))}catch(i){console.warn("code-editor-cloud failed, falling back to piston API:",i.message);const{language:y,version:v}=x,R=await Le.post("/execute",{language:y,version:v,files:[{name:s.name,content:s.content}],stdin:o});R.data.run.stderr?l(R.data.run.stderr):l(R.data.run.stdout)}else{const{language:i,version:y}=x,v=await Le.post("/execute",{language:i,version:y,files:[{name:s.name,content:s.content}],stdin:o});v.data.run.stderr?l(v.data.run.stderr):l(v.data.run.stdout)}u(!1),U.dismiss(),U.success("Code executed successfully")}catch(i){console.error("Execution error:",((g=i.response)==null?void 0:g.data)||i.message),u(!1),U.dismiss(),U.error("Failed to run the code")}};return e.jsx(Et.Provider,{value:{setInput:n,output:a,isRunning:d,supportedLanguages:c,selectedLanguage:x,setSelectedLanguage:m,runCode:f},children:t})};function tn(){const{viewHeight:t}=se(),{setInput:s,output:o,isRunning:n,supportedLanguages:a,selectedLanguage:l,setSelectedLanguage:d,runCode:u}=Zo(),c=x=>{const m=JSON.parse(x.target.value);d(m)},p=()=>{navigator.clipboard.writeText(o),U.success("Output copied to clipboard")};return e.jsxs("div",{className:"flex flex-col items-center gap-2 p-4",style:{height:t},children:[e.jsx("h1",{className:"view-title",children:"Run Code"}),e.jsxs("div",{className:"flex h-[90%] w-full flex-col items-end gap-2 md:h-[92%]",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx("select",{className:"w-full rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",value:JSON.stringify(l),onChange:c,children:a.sort((x,m)=>x.language>m.language?1:-1).map((x,m)=>e.jsx("option",{value:JSON.stringify(x),children:x.language+(x.version?` (${x.version})`:"")},m))}),e.jsx(Wt,{size:16,className:"absolute bottom-3 right-4 z-10 text-white"})]}),e.jsx("textarea",{className:"min-h-[120px] w-full resize-none rounded-md border-none bg-darkHover p-2 text-white outline-none",placeholder:"Write you input here...",onChange:x=>s(x.target.value)}),e.jsx("button",{className:"flex w-full justify-center rounded-md bg-primary p-2 font-bold text-black outline-none disabled:cursor-not-allowed disabled:opacity-50",onClick:u,disabled:n,children:"Run"}),e.jsxs("label",{className:"flex w-full justify-between",children:["Output :",e.jsx("button",{onClick:p,title:"Copy Output",children:e.jsx(Pe,{size:18,className:"cursor-pointer text-white"})})]}),e.jsx("div",{className:"w-full flex-grow resize-none overflow-y-auto rounded-md border-none bg-darkHover p-2 text-white outline-none",children:e.jsx("code",{children:e.jsx("pre",{className:"text-wrap",children:o})})})]})]})}const sn=["Anonymous Pro","Cousine","Fira Code","Inconsolata","JetBrains Mono","Jura","Roboto Mono","Source Code Pro","Space Mono","Ubuntu Mono"],vt={Abcdef:to,Abyss:eo,"Android Studio":Zs,Andromeda:Xs,"Atom One":Ks,Aura:Qs,"Basic Dark":qs,"Basic Light":Ys,BBEdit:Vs,Bespin:Js,Copilot:Bs,Darcula:$s,Dracula:Ws,"Duotone Dark":Gs,"Duotone Light":zs,Eclipse:Hs,"GitHub Dark":Us,"GitHub Light":Ms,"Gruvbox Dark":Fs,"Gruvbox Light":Ps,Kimbie:Ls,Material:As,"Material Dark":Ts,"Material Light":ks,Monokai:_s,"Monokai Dimmed":Is,"Noctis Lilac":Os,Nord:Ds,Okaidia:Ss,"Quiet Light":Rs,Red:Cs,"Solarized Dark":js,"Solarized Light":Ns,Sublime:vs,"Tokyo Night":Es,"Tokyo Night Day":ws,"Tokyo Night Storm":ys,"Tomorrow Night Blue":bs,"VS Code Dark":gs,"White Dark":xs,"White Light":hs,"Xcode Dark":ps,"Xcode Light":fs};function on({roomInfo:t,onRoomUpdate:s}){const{currentUser:o}=Q(),{socket:n}=K(),[a,l]=r.useState(!1),[d,u]=r.useState(!1),[c,p]=r.useState(!1),[x,m]=r.useState(""),[f,g]=r.useState(""),[i,y]=r.useState(""),[v,R]=r.useState(""),[k,j]=r.useState(""),[A,H]=r.useState(!1),[Y,z]=r.useState(!1),[$,V]=r.useState(""),[O,E]=r.useState(""),[w,I]=r.useState("");r.useEffect(()=>{t&&o.username&&J()},[t,o.username]),r.useEffect(()=>{t&&(m(t.room_name),H(t.is_active),console.log("[RoomEditSection] Room info initialized:",{name:t.room_name,active:t.is_active,deleted:t.is_delete}))},[t]);const J=()=>{!(t!=null&&t.room_id)||!o.username||(u(!0),n.emit(h.ROOM_OWNER_CHECK,{roomId:t.room_id}))},M=async()=>{if(!t||!o.username||!x.trim())return;if(x===t.room_name){alert("Room name is the same as current!");return}p(!0);const L={roomId:t.room_id,roomName:x.trim(),reason:k||"Room name updated"};console.log("[RoomEditSection] Sending room name update:",L),n.emit(h.EDIT_ROOM_REQUEST,L)},X=async()=>{if(!t||!o.username)return;if(!f.trim()){alert("Please enter a new password!");return}if(f!==i){alert("Passwords do not match!");return}p(!0);const L={roomId:t.room_id,password:f,reason:k||"Password updated"};console.log("[RoomEditSection] Sending password update:",L),n.emit(h.EDIT_ROOM_REQUEST,L)},oe=async()=>{if(!t||!o.username)return;if(!v){alert("Please enter current password to remove password protection!");return}p(!0);const L={roomId:t.room_id,password:null,reason:k||"Password protection removed"};console.log("[RoomEditSection] Sending remove password:",L),n.emit(h.EDIT_ROOM_REQUEST,L)},ee=async()=>{if(!t||!o.username||c)return;const L=!A,re=L?"activate":"deactivate";if(console.log("[RoomEditSection] Toggling active status from",A,"to",L),!window.confirm(`Are you sure you want to ${re} this room?`))return;p(!0),H(L);const b={roomId:t.room_id,isActive:L,reason:k||`Room ${re}d by owner`};console.log("[RoomEditSection] Sending active status change:",b),n.emit(h.EDIT_ROOM_REQUEST,b)},ne=()=>{t&&(z(!0),V(""),E(""),I(""))},pe=()=>{z(!1),V(""),E(""),I("")},he=async()=>{if(!t||!o.username)return;if($!==t.room_name){alert("Room name does not match!");return}if(!O){alert("Please enter your password to confirm deletion!");return}p(!0),z(!1);const L={roomId:t.room_id,isDelete:!0,reason:w||"Room deleted by owner"};console.log("[RoomEditSection] Sending delete request:",L),n.emit(h.EDIT_ROOM_REQUEST,L)},me=async()=>{if(!t||!o.username||!window.confirm("Are you sure you want to restore this room?"))return;p(!0);const L={roomId:t.room_id,isDelete:!1,reason:k||"Room restored by owner"};console.log("[RoomEditSection] Sending restore request:",L),n.emit(h.EDIT_ROOM_REQUEST,L)},xe=()=>{g(""),y(""),R(""),j(""),p(!1)};return r.useEffect(()=>{const L=b=>{u(!1),l(b.isOwner),console.log("[RoomEditSection] Room owner response:",b)},re=b=>{console.log("[RoomEditSection] Edit room response:",b),p(!1),b.success?(xe(),b.roomInfo&&(H(b.roomInfo.is_active),m(b.roomInfo.room_name),console.log("[RoomEditSection] State updated from response:",{active:b.roomInfo.is_active,name:b.roomInfo.room_name})),s&&s(),alert(b.message||"Room updated successfully!")):(alert(b.message||"Failed to update room"),t&&(H(t.is_active),m(t.room_name),console.log("[RoomEditSection] Reset state due to failure:",{active:t.is_active,name:t.room_name})))};return n.on(h.ROOM_OWNER_RESPONSE,L),n.on(h.EDIT_ROOM_RESPONSE,re),()=>{n.off(h.ROOM_OWNER_RESPONSE,L),n.off(h.EDIT_ROOM_RESPONSE,re)}},[n,s,t]),t?d?e.jsx("div",{className:"w-full rounded-lg border border-gray-700 bg-darkHover p-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 py-4 text-yellow-400",children:[e.jsx("div",{className:"h-2 w-2 animate-ping rounded-full bg-yellow-400"}),"Checking room ownership..."]})}):a?e.jsxs(e.Fragment,{children:[Y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-darkHover border border-gray-700 rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Confirm Room Deletion"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-300",children:"This action cannot be undone. Please confirm by entering the required information."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm text-gray-400",children:["Type the room name to confirm: ",e.jsx("span",{className:"font-medium text-white",children:t.room_name})]}),e.jsx("input",{type:"text",value:$,onChange:L=>V(L.target.value),placeholder:`Type "${t.room_name}" to confirm`,className:"w-full rounded-md border border-gray-600 bg-darkHover px-3 py-2 text-white outline-none focus:border-red-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Enter your password to confirm"}),e.jsx("input",{type:"password",value:O,onChange:L=>E(L.target.value),placeholder:"Enter your password",className:"w-full rounded-md border border-gray-600 bg-darkHover px-3 py-2 text-white outline-none focus:border-red-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Reason for deletion (optional)"}),e.jsx("textarea",{value:w,onChange:L=>I(L.target.value),placeholder:"Why are you deleting this room?",rows:2,className:"w-full rounded-md border border-gray-600 bg-darkHover px-3 py-2 text-white outline-none focus:border-red-500 resize-none"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:pe,className:"flex-1 rounded-md bg-gray-600 px-4 py-2 text-white hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:he,disabled:c||$!==t.room_name||!O,className:"flex-1 rounded-md bg-red-500/20 px-4 py-2 text-red-400 hover:bg-red-500/30 disabled:opacity-50",children:c?"Deleting...":"Delete Room"})]})]})]})}),e.jsxs("div",{className:"w-full rounded-lg border border-gray-700 bg-darkHover p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Room Management"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-md font-medium text-white border-b border-gray-600 pb-2",children:"Change Room Name"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Current:"}),e.jsx("span",{className:"text-white font-medium",children:t.room_name})]}),e.jsx("input",{type:"text",value:x,onChange:L=>m(L.target.value),placeholder:"Enter new room name",className:"rounded-md border border-gray-600 bg-darkHover px-3 py-2 text-white outline-none focus:border-primary"})]}),e.jsx("button",{onClick:M,disabled:c||!x.trim()||x===t.room_name,className:"rounded-md bg-blue-500/20 px-4 py-2 text-blue-400 hover:bg-blue-500/30 disabled:opacity-50",children:c?"Updating...":"Update Room Name"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-md font-medium text-white border-b border-gray-600 pb-2",children:"Password Management"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-sm text-gray-300",children:"Set New Password"}),e.jsx("input",{type:"password",value:f,onChange:L=>g(L.target.value),placeholder:"Enter new password",className:"w-full rounded-md border border-gray-600 bg-darkHover px-3 py-2 text-white outline-none focus:border-primary"}),e.jsx("input",{type:"password",value:i,onChange:L=>y(L.target.value),placeholder:"Confirm new password",className:"w-full rounded-md border border-gray-600 bg-darkHover px-3 py-2 text-white outline-none focus:border-primary"}),e.jsx("button",{onClick:X,disabled:c||!f||!i||f!==i,className:"rounded-md bg-green-500/20 px-4 py-2 text-green-400 hover:bg-green-500/30 disabled:opacity-50",children:c?"Updating...":"Update Password"})]}),t.has_password&&e.jsxs("div",{className:"space-y-2 pt-4 border-t border-gray-600",children:[e.jsx("h5",{className:"text-sm text-gray-300",children:"Remove Password Protection"}),e.jsx("input",{type:"password",value:v,onChange:L=>R(L.target.value),placeholder:"Enter current password to remove protection",className:"w-full rounded-md border border-gray-600 bg-darkHover px-3 py-2 text-white outline-none focus:border-primary"}),e.jsx("button",{onClick:oe,disabled:c||!v,className:"rounded-md bg-red-500/20 px-4 py-2 text-red-400 hover:bg-red-500/30 disabled:opacity-50",children:c?"Removing...":"Remove Password"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-md font-medium text-white border-b border-gray-600 pb-2",children:"Room Status"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-white",children:A?"Deactivate this room":"Activate this room"}),e.jsx("span",{className:"text-xs text-gray-400",children:A?"Room is currently active and accessible to users":"Room is currently inactive and hidden from users"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-sm font-medium ${A?"text-green-400":"text-red-400"}`,children:A?"ACTIVE":"INACTIVE"}),e.jsx("button",{onClick:ee,disabled:c,className:`relative inline-flex h-6 w-12 items-center rounded-full transition-colors focus:outline-none ${A?"bg-green-500":"bg-red-500"} ${c?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${A?"translate-x-7":"translate-x-1"}`})})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-white",children:"Delete Room"}),e.jsx("span",{className:"text-xs text-gray-400",children:t.is_delete?"Room is currently deleted":"Permanently delete this room"})]}),t.is_delete?e.jsx("button",{onClick:me,disabled:c,className:"rounded-md bg-green-500/20 px-4 py-2 text-green-400 hover:bg-green-500/30 disabled:opacity-50",children:c?"Restoring...":"Restore Room"}):e.jsx("button",{onClick:ne,disabled:c,className:"rounded-md bg-red-500/20 px-4 py-2 text-red-400 hover:bg-red-500/30 disabled:opacity-50",children:"Delete Room"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-md font-medium text-white border-b border-gray-600 pb-2",children:"Reason for Changes (Optional)"}),e.jsx("textarea",{value:k,onChange:L=>j(L.target.value),placeholder:"Explain why you're making these changes...",rows:2,className:"w-full rounded-md border border-gray-600 bg-darkHover px-3 py-2 text-white outline-none focus:border-primary resize-none"})]})]})]})]}):e.jsx("div",{className:"w-full rounded-lg border border-gray-700 bg-darkHover p-4",children:e.jsx("div",{className:"text-center py-4 text-gray-400",children:"Room management options are only available for the room owner."})}):null}function nn(){const{theme:t,setTheme:s,language:o,setLanguage:n,fontSize:a,setFontSize:l,fontFamily:d,setFontFamily:u,showGitHubCorner:c,setShowGitHubCorner:p,resetSettings:x}=Ne(),{currentUser:m}=Q(),{socket:f}=K(),{viewHeight:g}=se(),[i,y]=r.useState(null),[v,R]=r.useState(!1),k=w=>{const I=w.target.value;u(I),z(I)},j=w=>{s(w.target.value)},A=w=>{n(w.target.value)},H=w=>{const I=parseInt(w.target.value);l(I),$(I)},Y=w=>{p(w.target.checked)},z=w=>{const I=document.querySelector(".cm-editor > .cm-scroller");I&&(I.style.fontFamily=`${w}, monospace`)},$=w=>{const I=document.querySelector(".cm-editor > .cm-scroller");I&&(I.style.fontSize=`${w}px`)},V=()=>{z(d),$(a)};r.useEffect(()=>{m.roomId&&O()},[m.roomId]),r.useEffect(()=>{V()},[]);const O=()=>{m.roomId&&(R(!0),f.emit(h.ROOM_INFO_REQUEST,{roomId:m.roomId}))};r.useEffect(()=>{const w=M=>{R(!1),console.log("[SettingsView] Room info received:",M.roomInfo);const X={room_id:M.roomInfo.room_id,room_name:M.roomInfo.room_name,owner_name:M.roomInfo.owner_name||"Unknown",has_password:M.roomInfo.has_password||!1,is_active:M.roomInfo.is_active!==void 0?!!M.roomInfo.is_active:M.roomInfo.status===1||M.roomInfo.status==="active",is_delete:M.roomInfo.is_delete!==void 0?!!M.roomInfo.is_delete:!1,created_at:M.roomInfo.created_at,user_count:M.roomInfo.user_count||0};console.log("[SettingsView] Processed room info:",X),y(X)},I=M=>{R(!1),console.log("[SettingsView] Room info error:",M.message),M.message==="Room not found"&&y(null)},J=M=>{console.log("[SettingsView] Room edit response received:",M),M.success&&M.roomInfo&&(y(M.roomInfo),console.log("[SettingsView] Room info updated from edit response"))};return f.on(h.ROOM_INFO_RESPONSE,w),f.on(h.ERROR,I),f.on(h.EDIT_ROOM_RESPONSE,J),()=>{f.off(h.ROOM_INFO_RESPONSE,w),f.off(h.ERROR,I),f.off(h.EDIT_ROOM_RESPONSE,J)}},[f]),r.useEffect(()=>{z(d)},[d]),r.useEffect(()=>{$(a)},[a]);const E=()=>{console.log("[SettingsView] Refreshing room info after update"),O()};return e.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 overflow-y-auto",style:{height:g},children:[e.jsx("h1",{className:"view-title",children:"Settings"}),m.roomId&&e.jsxs("div",{className:"w-full rounded-lg border border-gray-700 bg-darkHover p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Room Information"}),e.jsxs("button",{onClick:O,className:"flex items-center gap-2 rounded-md bg-primary/20 px-3 py-1 text-primary hover:bg-primary/30 disabled:opacity-50",disabled:v,children:[e.jsx("svg",{className:`h-4 w-4 ${v?"animate-spin":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Reload"]})]}),v?e.jsxs("div",{className:"flex items-center justify-center gap-2 py-4 text-yellow-400",children:[e.jsx("div",{className:"h-2 w-2 animate-ping rounded-full bg-yellow-400"}),"Loading room information..."]}):i?e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Room ID:"}),e.jsx("span",{className:"font-mono text-white bg-black/30 px-2 py-1 rounded text-xs",children:i.room_id})]})}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gray-400",children:"Room name"}),e.jsx("span",{className:"text-white font-medium",children:i.room_name})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gray-400",children:"Status"}),e.jsx("span",{className:`font-medium ${i.is_delete?"text-red-400":i.is_active?"text-green-400":"text-yellow-400"}`,children:i.is_delete?"Deleted":i.is_active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gray-400",children:"Password Protected"}),e.jsx("span",{className:i.has_password?"text-yellow-400 font-medium":"text-green-400 font-medium",children:i.has_password?"Yes":"No"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gray-400",children:"Created by"}),e.jsx("span",{className:"text-white font-medium",children:i.owner_name||"Unknown"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gray-400",children:"Users"}),e.jsxs("span",{className:"text-white font-medium",children:[i.user_count," online"]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-gray-400",children:"Created"}),e.jsx("span",{className:"text-white font-medium",children:new Date(i.created_at).toLocaleDateString()})]})]}):e.jsx("div",{className:"text-center py-4 text-gray-400",children:"Room information not available"})]}),i&&i.room_id&&e.jsx(on,{roomInfo:i,onRoomUpdate:E}),e.jsxs("div",{className:"w-full rounded-lg border border-gray-700 bg-darkHover p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-white",children:"Editor Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Font Family"}),e.jsx("select",{value:d,onChange:k,className:"rounded-md border border-gray-600 bg-darkHover px-3 py-2 text-white outline-none focus:border-primary",children:sn.map(w=>e.jsx("option",{value:w,children:w},w))})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Font Size"}),e.jsx("select",{value:a,onChange:H,className:"rounded-md border border-gray-600 bg-darkHover px-3 py-2 text-white outline-none focus:border-primary",children:[...Array(13).keys()].map(w=>e.jsxs("option",{value:w+12,children:[w+12,"px"]},w))})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Theme"}),e.jsx("select",{value:t,onChange:j,className:"rounded-md border border-gray-600 bg-darkHover px-3 py-2 text-white outline-none focus:border-primary",children:Object.keys(vt).map(w=>e.jsx("option",{value:w,children:w},w))})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Language"}),e.jsx("select",{value:o,onChange:A,className:"rounded-md border border-gray-600 bg-darkHover px-3 py-2 text-white outline-none focus:border-primary",children:so.map(w=>e.jsx("option",{value:w,children:w},w))})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-white",children:"Show GitHub Corner"}),e.jsx("span",{className:"text-xs text-gray-400",children:"Display GitHub corner ribbon"})]}),e.jsxs("label",{className:"relative inline-flex cursor-pointer items-center",children:[e.jsx("input",{className:"peer sr-only",type:"checkbox",onChange:Y,checked:c}),e.jsx("div",{className:"peer h-6 w-12 rounded-full bg-gray-600 outline-none duration-100 after:absolute after:left-1 after:top-1 after:flex after:h-4 after:w-4 after:items-center after:justify-center after:rounded-full after:bg-white after:font-bold after:outline-none after:duration-500 peer-checked:after:translate-x-6 peer-checked:bg-primary peer-focus:outline-none"})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx("button",{className:"flex-1 rounded-md border border-gray-600 bg-darkHover px-4 py-3 text-white outline-none hover:bg-darkHover/80 transition-colors",onClick:V,children:"Apply Settings"}),e.jsx("button",{className:"flex-1 rounded-md border-none bg-red-500/20 px-4 py-3 text-red-400 outline-none hover:bg-red-500/30 transition-colors",onClick:x,children:"Reset to Default"})]})]})}function rn(){const{users:t,setUsers:s,currentUser:o}=Q(),{socket:n}=K(),[a,l]=r.useState([]),[d,u]=r.useState(!1),[c,p]=r.useState(!1),[x,m]=r.useState(!1);return r.useEffect(()=>{if(!n)return;const f=g=>{console.log("Photo updated for user:",g.username,g.photo),s(i=>i.map(y=>y.username===g.username?{...y,photo:g.photo}:y))};return n.on("USER_PHOTO_UPDATED",f),()=>{n.off("USER_PHOTO_UPDATED",f)}},[n,s]),r.useEffect(()=>{if(!n||!(o!=null&&o.roomId))return;const f=j=>{console.log("Room owner response:",j),u(j.isOwner),j.isOwner&&c&&R()},g=j=>{console.log("Room users list received:",j.users),l(j.users),m(!1)},i=j=>{console.log("User status updated:",j),l(A=>A.map(H=>H.username===j.username?{...H,is_active:j.is_active}:H)),U.success(`User ${j.is_active?"activated":"deactivated"}`)},y=j=>{console.log("User banned status updated:",j),l(A=>A.map(H=>H.username===j.username?{...H,is_banned:j.is_banned}:H)),U.success(`User ${j.is_banned?"banned":"unbanned"}`)},v=j=>{console.log("User approved:",j),l(A=>A.map(H=>H.username===j.username?{...H,is_active:!0}:H)),U.success("User approved")},R=()=>{m(!0),n.emit("GET_ROOM_USERS",{roomId:o.roomId})},k=()=>{n.emit("ROOM_OWNER_CHECK",{roomId:o.roomId})};return n.on("ROOM_OWNER_RESPONSE",f),n.on("ROOM_USERS_LIST",g),n.on("USER_STATUS_UPDATED",i),n.on("USER_BANNED_STATUS",y),n.on("USER_APPROVED",v),k(),()=>{n.off("ROOM_OWNER_RESPONSE",f),n.off("ROOM_USERS_LIST",g),n.off("USER_STATUS_UPDATED",i),n.off("USER_BANNED_STATUS",y),n.off("USER_APPROVED",v)}},[n,o,c]),r.useEffect(()=>{c&&d&&(o!=null&&o.roomId)&&(m(!0),n==null||n.emit("GET_ROOM_USERS",{roomId:o.roomId}))},[c,d,o,n]),e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[c?"Room Users":"Online Users",e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",c?a.length:t.length,")"]})]}),d&&e.jsxs("button",{onClick:()=>p(!c),className:`flex items-center gap-2 px-3 py-2 text-sm rounded-lg transition-colors ${c?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"}`,title:c?"Show Online Users":"Manage Room Users",children:[e.jsx($t,{size:16}),c?"Online View":"Manage Users"]})]}),d&&c&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:"Room Owner Dashboard - Manage all users in this room"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:c&&d?e.jsx("div",{className:"p-4",children:x?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading users..."})}):e.jsxs("div",{className:"space-y-3",children:[a.map(f=>e.jsx(ln,{roomUser:f,isOwner:d,currentUsername:o==null?void 0:o.username},f.username)),a.length===0&&e.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"No users found in this room"})]})}):e.jsx("div",{className:"flex min-h-[200px] flex-grow justify-center overflow-y-auto py-2",children:e.jsx("div",{className:"flex h-full w-full flex-wrap items-start gap-x-2 gap-y-6 px-4",children:t.map(f=>e.jsx(an,{user:f},f.socketId))})})})]})}const an=({user:t})=>{const{currentUser:s}=Q(),{socket:o}=K(),{username:n,status:a,photo:l,roomId:d}=t,u="https://cloud.coderpoint.ru",c=(s==null?void 0:s.username)===n,p=async m=>{var i;if(!c)return;const f=(i=m.target.files)==null?void 0:i[0];if(!f)return;console.log("Uploading file:",f.name);const g=new FormData;g.append("photo",f),g.append("roomId",d),g.append("username",n);try{const v=await(await fetch(`${u}/upload-photo`,{method:"POST",body:g})).json();console.log("Upload response:",v),v.success&&v.photo?(U.success("Photo updated!"),console.log("New photo path:",v.photo),o.emit("USER_PHOTO_UPDATED",{username:n,photo:v.photo})):U.error("Failed to update photo")}catch(y){console.error("Upload error:",y),U.error("Server error")}},x=l?`${u}${l}`:void 0;return e.jsxs("div",{className:"relative flex w-[100px] flex-col items-center gap-2",children:[e.jsxs("label",{className:`group relative ${c?"cursor-pointer":"cursor-default"}`,children:[x?e.jsx("img",{src:x,alt:n,className:"h-[50px] w-[50px] rounded-xl object-cover",onError:()=>console.error("Failed to load image:",x)}):e.jsx(it,{name:n,size:"50",round:"12px"}),c&&e.jsx("div",{className:`
                            absolute bottom-[-4px] right-[-4px]
                            bg-black/60 text-white
                            p-[2px] rounded-full
                            opacity-0 group-hover:opacity-100
                            transition-opacity
                        `,children:e.jsx(Yt,{size:14})}),c&&e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:p})]}),e.jsx("p",{className:"line-clamp-2 max-w-full text-ellipsis break-words text-gray-900 dark:text-white text-center text-sm",children:n}),e.jsx("div",{className:`absolute right-5 top-0 h-3 w-3 rounded-full ${a===ve.ONLINE?"bg-green-500":"bg-red-500"}`})]})},ln=({roomUser:t,isOwner:s,currentUsername:o})=>{const{socket:n}=K(),{currentUser:a,users:l}=Q(),d="https://cloud.coderpoint.ru",u=o===t.username,c=t.photo?`${d}${t.photo}`:void 0,p=l.find(j=>j.username===t.username),x=(p==null?void 0:p.status)===ve.ONLINE,m=()=>{const j=a==null?void 0:a.roomId;j&&n.emit("APPROVE_USER",{roomId:j,username:t.username})},f=()=>{const j=a==null?void 0:a.roomId;j&&n.emit("REJECT_USER",{roomId:j,username:t.username})},g=()=>{const j=a==null?void 0:a.roomId;j&&n.emit("UPDATE_USER_STATUS",{roomId:j,username:t.username,is_active:!0})},i=()=>{const j=a==null?void 0:a.roomId;j&&n.emit("UPDATE_USER_STATUS",{roomId:j,username:t.username,is_active:!1})},y=()=>{const j=a==null?void 0:a.roomId;j&&n.emit("BAN_USER",{roomId:j,username:t.username,reason:"Banned by room owner"})},v=()=>{const j=a==null?void 0:a.roomId;j&&n.emit("UNBAN_USER",{roomId:j,username:t.username})},R=()=>t.is_banned?"Banned":t.is_active?"Active":"Pending",k=()=>t.is_banned?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":t.is_active?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:shadow-sm transition-all",children:[e.jsxs("div",{className:"flex items-center space-x-4 flex-1 min-w-0",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[c?e.jsx("img",{src:c,alt:t.username,className:"h-12 w-12 rounded-xl object-cover border-2 border-gray-200 dark:border-gray-600",onError:()=>console.error("Failed to load image:",c)}):e.jsx("div",{className:"h-12 w-12 rounded-xl border-2 border-gray-200 dark:border-gray-600",children:e.jsx(it,{name:t.username,size:"48",round:"10px"})}),e.jsx("div",{className:`absolute -bottom-1 -right-1 h-4 w-4 rounded-full border-2 border-white dark:border-gray-800 ${x&&t.is_active&&!t.is_banned?"bg-green-500":"bg-gray-400"}`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white truncate",children:t.username}),t.is_owner&&e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded-full",children:"Owner"}),u&&e.jsx("span",{className:"px-2 py-1 text-xs bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200 rounded-full",children:"You"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${k()}`,children:R()}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:x?"Online":"Offline"})]})]})]}),s&&!u&&e.jsxs("div",{className:"flex items-center space-x-2 ml-4 flex-shrink-0",children:[!t.is_active&&!t.is_banned&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:m,className:"flex items-center justify-center p-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors shadow-sm",title:"Approve User",children:e.jsx(Bt,{size:18})}),e.jsx("button",{onClick:f,className:"flex items-center justify-center p-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors shadow-sm",title:"Reject User",children:e.jsx(Jt,{size:18})})]}),t.is_active&&!t.is_banned&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i,className:"flex items-center justify-center p-2 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg transition-colors shadow-sm",title:"Deactivate User",children:e.jsx(Vt,{size:18})}),e.jsx("button",{onClick:y,className:"flex items-center justify-center p-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors shadow-sm",title:"Ban User",children:e.jsx($e,{size:18})})]}),!t.is_active&&!t.is_banned&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:g,className:"flex items-center justify-center p-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors shadow-sm",title:"Activate User",children:e.jsx(Be,{size:18})}),e.jsx("button",{onClick:y,className:"flex items-center justify-center p-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors shadow-sm",title:"Ban User",children:e.jsx($e,{size:18})})]}),t.is_banned&&e.jsx("button",{onClick:v,className:"flex items-center justify-center p-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors shadow-sm",title:"Unban User",children:e.jsx(Be,{size:18})})]})]})};function cn(){const t=ke(),{viewHeight:s}=se(),{setStatus:o,currentUser:n}=Q(),{socket:a}=K(),l=async()=>{const c=window.location.href,p=(n==null?void 0:n.roomId)||"Chat Room",x=`Join me in "${p}" room!
${c}`;try{await navigator.clipboard.writeText(x),U.success(`"${p}" room link copied!`)}catch(m){U.error("Unable to copy URL to clipboard"),console.log(m)}},d=async()=>{var f;const c=window.location.href,p=(n==null?void 0:n.roomId)||"Chat Room",x=`Join me in "${p}" room!`,m={title:`${p} - Chat Room`,text:x,url:c};try{navigator.share&&((f=navigator.canShare)!=null&&f.call(navigator,m))?(await navigator.share(m),U.success(`"${p}" room shared successfully!`)):(await navigator.clipboard.writeText(`${x}
${c}`),U.success(`"${p}" room link copied to clipboard!`))}catch(g){g.name!=="AbortError"&&(await navigator.clipboard.writeText(`${x}
${c}`),U.success(`"${p}" room link copied to clipboard!`))}},u=()=>{a.disconnect(),o(F.DISCONNECTED),t("/",{replace:!0})};return e.jsxs("div",{className:"flex flex-col p-4",style:{height:s},children:[e.jsx("div",{className:"mb-6",children:e.jsx("h1",{className:"view-title",children:"Users"})}),e.jsx(rn,{}),e.jsx("div",{className:"flex flex-col items-center gap-4 pt-4",children:e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-white p-3 text-black",onClick:d,title:`Share "${(n==null?void 0:n.roomId)||"Room"}" link`,children:e.jsx(qt,{size:26})}),e.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-white p-3 text-black",onClick:l,title:`Copy "${(n==null?void 0:n.roomId)||"Room"}" link`,children:e.jsx(Pe,{size:22})}),e.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-primary p-3 text-black",onClick:u,title:"Leave room",children:e.jsx(Qt,{size:22})})]})})]})}var W=(t=>(t.FILES="FILES",t.CHATS="CHATS",t.CLIENTS="CLIENTS",t.RUN="RUN",t.COPILOT="COPILOT",t.SETTINGS="SETTINGS",t))(W||{});const Nt=r.createContext(null),Te=()=>{const t=r.useContext(Nt);if(!t)throw new Error("useViews must be used within a ViewContextProvider");return t};function dn({children:t}){const{isMobile:s}=fe(),[o,n]=r.useState(W.FILES),[a,l]=r.useState(!s),[d]=r.useState({[W.FILES]:e.jsx(qo,{}),[W.CLIENTS]:e.jsx(cn,{}),[W.SETTINGS]:e.jsx(nn,{}),[W.COPILOT]:e.jsx($o,{}),[W.CHATS]:e.jsx(Po,{}),[W.RUN]:e.jsx(tn,{})}),[u]=r.useState({[W.FILES]:e.jsx(ss,{size:28}),[W.CLIENTS]:e.jsx(ts,{size:30}),[W.SETTINGS]:e.jsx(es,{size:28}),[W.CHATS]:e.jsx(Zt,{size:30}),[W.COPILOT]:e.jsx(Xt,{size:28}),[W.RUN]:e.jsx(Kt,{size:28})});return e.jsx(Nt.Provider,{value:{activeView:o,setActiveView:n,isSidebarOpen:a,setIsSidebarOpen:l,viewComponents:d,viewIcons:u},children:t})}function un({children:t}){const{isSidebarOpen:s}=Te(),{isMobile:o,width:n}=fe(),{setItem:a,getItem:l}=lt(),d=()=>{const f=document.createElement("div");return f.className="h-full cursor-e-resizer hidden md:block",f.style.backgroundColor="#e1e1ffb3",f},u=()=>{if(o)return[0,n];const f=l("editorSizes");let g=[35,65];return f&&(g=JSON.parse(f)),s?g:[0,n]},c=()=>o?[0,n]:s?[350,350]:[50,0],p=()=>o?[0,1/0]:s?[1/0,1/0]:[0,1/0],x=f=>{a("editorSizes",JSON.stringify(f))},m=()=>({width:"7px",display:s&&!o?"block":"none"});return e.jsx(io,{sizes:u(),minSize:c(),gutter:d,maxSize:p(),dragInterval:1,direction:"horizontal",gutterAlign:"center",cursor:"e-resize",snapOffset:30,gutterStyle:m,onDrag:x,className:"flex h-screen min-h-screen max-w-full items-center justify-center overflow-hidden",children:t})}function mn(){return e.jsx("div",{className:"flex h-screen min-h-screen flex-col items-center justify-center gap-6 px-4 text-center",children:e.jsx(fn,{})})}const fn=()=>{const t=ke(),s=()=>{window.location.reload()},o=()=>{t("/")};return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"whitespace-break-spaces text-lg font-medium text-slate-300",children:"Oops! Something went wrong. Please try again"}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-4",children:[e.jsx("button",{className:"mr-4 rounded-md bg-primary px-8 py-2 font-bold text-black",onClick:s,children:"Try Again"}),e.jsx("button",{className:"rounded-md bg-primary px-8 py-2 font-bold text-black",onClick:o,children:"Go to HomePage"})]})]})},Ie={backgroundColor:"#e0e0e0",padding:"8px 12px",borderRadius:"6px",color:"#000",fontSize:"12px",fontWeight:"500",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},Ke={base:"relative flex items-center justify-center rounded transition-colors duration-200 ease-in-out p-2",hover:"hover:bg-[#3D404A]"},ye=({viewName:t,icon:s})=>{const{activeView:o,setActiveView:n,isSidebarOpen:a,setIsSidebarOpen:l}=Te(),{isNewMessage:d}=Ue(),[u,c]=r.useState(!0),p=x=>{x===o?l(!a):(l(!0),n(x))};return e.jsxs("div",{className:"relative flex flex-col items-center",children:[e.jsxs("button",{onClick:()=>p(t),onMouseEnter:()=>c(!0),className:`${Ke.base} ${Ke.hover}`,...u&&{"data-tooltip-id":`tooltip-${t}`,"data-tooltip-content":t},children:[e.jsx("div",{className:"flex items-center justify-center",children:s}),t===W.CHATS&&d&&e.jsx("div",{className:"absolute right-0 top-0 h-3 w-3 rounded-full bg-primary"})]}),u&&e.jsx(De,{id:`tooltip-${t}`,place:"right",offset:25,className:"!z-50",style:Ie,noArrow:!1,positionStrategy:"fixed",float:!0})]})};class pn{constructor(s,o,n){Ee(this,"peerConnection",null);Ee(this,"localStream",null);Ee(this,"remoteStreams",new Map);Ee(this,"isAudioEnabled",!1);this.socket=s,this.roomId=o,this.username=n,this.initializePeerConnection()}initializePeerConnection(){const s={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]};this.peerConnection=new RTCPeerConnection(s),this.peerConnection.ontrack=o=>{const[n]=o.streams,a=o.transceiver.mid||"unknown";this.remoteStreams.set(a,n),this.socket.emit("REMOTE_AUDIO_STREAM_ADDED",{userId:a,roomId:this.roomId,username:this.username})},this.peerConnection.onicecandidate=o=>{o.candidate&&this.socket.emit("WEBRTC_ICE_CANDIDATE",{candidate:o.candidate,roomId:this.roomId,targetUser:this.username})},this.peerConnection.onconnectionstatechange=()=>{var o;console.log("WebRTC connection state:",(o=this.peerConnection)==null?void 0:o.connectionState)}}async enableAudio(){try{return this.localStream=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),this.localStream.getAudioTracks().forEach(s=>{var o;(o=this.peerConnection)==null||o.addTrack(s,this.localStream)}),this.isAudioEnabled=!0,!0}catch(s){return console.error("Error enabling audio:",s),this.isAudioEnabled=!1,!1}}disableAudio(){this.localStream&&(this.localStream.getTracks().forEach(s=>{s.stop()}),this.localStream=null),this.peerConnection&&this.peerConnection.getSenders().forEach(s=>{s.track&&s.track.stop()}),this.isAudioEnabled=!1}async createOffer(){try{if(!this.peerConnection)return null;const s=await this.peerConnection.createOffer();return await this.peerConnection.setLocalDescription(s),s}catch(s){return console.error("Error creating offer:",s),null}}async handleOffer(s){try{if(!this.peerConnection)return null;await this.peerConnection.setRemoteDescription(s);const o=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(o),o}catch(o){return console.error("Error handling offer:",o),null}}async handleAnswer(s){try{if(!this.peerConnection)return;await this.peerConnection.setRemoteDescription(s)}catch(o){console.error("Error handling answer:",o)}}async addIceCandidate(s){try{if(!this.peerConnection)return;await this.peerConnection.addIceCandidate(s)}catch(o){console.error("Error adding ICE candidate:",o)}}getLocalStream(){return this.localStream}getRemoteStreams(){return this.remoteStreams}getIsAudioEnabled(){return this.isAudioEnabled}close(){this.disableAudio(),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),this.remoteStreams.clear()}}const hn=({roomId:t,username:s})=>{const{socket:o}=K(),{setUserAudioStreams:n}=Q(),[a,l]=r.useState(!1),[d,u]=r.useState(!1),[c,p]=r.useState(!1),[x,m]=r.useState(!0),[f,g]=r.useState(!1),i=r.useRef(null),y=r.useRef(null),v=r.useRef(null),R=r.useRef(null),k=r.useRef(0);r.useEffect(()=>{if(!(!o||!t))return i.current=new pn(o,t,s),o.on("WEBRTC_OFFER",async E=>{if(!i.current)return;const w=await i.current.handleOffer(E.offer);w&&o.emit("WEBRTC_ANSWER",{answer:w,roomId:t,targetUser:E.fromUser})}),o.on("WEBRTC_ANSWER",async E=>{var w;await((w=i.current)==null?void 0:w.handleAnswer(E.answer))}),o.on("WEBRTC_ICE_CANDIDATE",async E=>{var w;await((w=i.current)==null?void 0:w.addIceCandidate(E.candidate))}),o.on("REMOTE_AUDIO_STREAM_ADDED",E=>{var I;const w=(I=i.current)==null?void 0:I.getRemoteStreams();if(w&&w.has(E.userId)){const J=w.get(E.userId);J&&n(M=>({...M,[E.username]:J}))}}),o.on("USER_AUDIO_TOGGLED",E=>{E.username!==s&&console.log(`User ${E.username} ${E.isAudioEnabled?"enabled":"disabled"} audio`)}),Y(),()=>{var E;o.off("WEBRTC_OFFER"),o.off("WEBRTC_ANSWER"),o.off("WEBRTC_ICE_CANDIDATE"),o.off("REMOTE_AUDIO_STREAM_ADDED"),o.off("USER_AUDIO_TOGGLED"),H(),(E=i.current)==null||E.close()}},[o,t,s,n]);const j=E=>{try{v.current=new AudioContext,R.current=v.current.createAnalyser();const w=v.current.createMediaStreamSource(E);R.current.fftSize=256,R.current.smoothingTimeConstant=.8,w.connect(R.current),A()}catch(w){console.error("Error setting up audio analysis:",w)}},A=()=>{if(!R.current)return;const E=new Uint8Array(R.current.frequencyBinCount);R.current.getByteFrequencyData(E);let w=0;for(let J=0;J<E.length;J++)w+=E[J];const I=w/E.length;g(I>20),k.current=requestAnimationFrame(A)},H=()=>{k.current&&cancelAnimationFrame(k.current),v.current&&(v.current.close(),v.current=null),R.current=null,g(!1)},Y=async()=>{try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(w=>w.stop()),u(!0)}catch{u(!1)}},z=async()=>{try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(w=>w.stop()),u(!0),!0}catch(E){return console.error("Audio permission denied:",E),u(!1),!1}},$=async()=>{if(!(!i.current||!o)){p(!0);try{if(a)H(),i.current.disableAudio(),l(!1),y.current&&(y.current.srcObject=null),o.emit("USER_AUDIO_TOGGLED",{roomId:t,username:s,isAudioEnabled:!1});else{if(!d&&!await z()){alert("Microphone access is required for audio communication");return}if(await i.current.enableAudio()){l(!0);const w=i.current.getLocalStream();w&&j(w);const I=await i.current.createOffer();I&&o.emit("WEBRTC_OFFER",{offer:I,roomId:t,targetUser:"all"}),y.current&&w&&(y.current.srcObject=w),o.emit("USER_AUDIO_TOGGLED",{roomId:t,username:s,isAudioEnabled:!0})}}}catch(E){console.error("Error toggling audio:",E)}finally{p(!1)}}},V=()=>d?c?"Loading...":a?f?"Speaking...":"Microphone On":"Enable Audio":"No Microphone Access",O=()=>{const E={width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"};return a&&d?e.jsxs("svg",{...E,className:"text-green-400",children:[e.jsx("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),e.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),e.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),e.jsx("line",{x1:"8",y1:"23",x2:"16",y2:"23"}),f&&e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M3 12h1",className:"animate-pulse"}),e.jsx("path",{d:"M6 9h1",className:"animate-pulse",style:{animationDelay:"0.1s"}}),e.jsx("path",{d:"M9 6h1",className:"animate-pulse",style:{animationDelay:"0.2s"}})]})]}):e.jsxs("svg",{...E,className:"text-red-400",children:[e.jsx("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),e.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),e.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),e.jsx("line",{x1:"8",y1:"23",x2:"16",y2:"23"}),e.jsx("line",{x1:"4",y1:"12",x2:"20",y2:"12",stroke:"currentColor",strokeWidth:"2"})]})};return e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("button",{className:`flex items-center justify-center rounded p-1.5 transition-colors duration-200 ease-in-out hover:bg-[#3D404A] ${c?"opacity-50 cursor-not-allowed":""}`,onClick:$,disabled:c,onMouseEnter:()=>m(!0),"data-tooltip-id":"audio-control-tooltip","data-tooltip-content":V(),children:O()}),x&&e.jsx(De,{id:"audio-control-tooltip",place:"right",offset:15,className:"!z-50",style:Ie,noArrow:!1,positionStrategy:"fixed",float:!0})]})};function xn(){const{activeView:t,isSidebarOpen:s,viewComponents:o,viewIcons:n,setIsSidebarOpen:a}=Te(),{minHeightReached:l}=se(),{activityState:d,setActivityState:u,currentUser:c,roomId:p}=Q(),{socket:x}=K(),{isMobile:m}=fe(),[f,g]=r.useState(!0),[i,y]=r.useState(!1),[v,R]=r.useState(""),[k,j]=r.useState(""),[A,H]=r.useState(!1),Y=()=>{g(!1),d===le.CODING?(u(le.DRAWING),x.emit(h.REQUEST_DRAWING)):u(le.CODING),m&&a(!1)},z=async()=>{if(v.trim()){H(!0),j(E=>E+`
$ ${v}
`);try{const w=await(await fetch("https://cloud.code-editor.ru/api/terminal.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:v})})).json();w.success?j(I=>I+w.output+`
`):j(I=>I+`Error: ${w.error}
`)}catch(E){j(w=>w+`Network Error: ${E}
`)}finally{H(!1),R("")}}},$=E=>{E.key==="Enter"&&!E.shiftKey&&(E.preventDefault(),z())},V=()=>{j("")},O=E=>{R(`pip install ${E}`)};return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:"flex w-full md:h-full md:max-h-full md:min-h-full md:w-auto",children:[e.jsxs("div",{className:we("fixed bottom-0 left-0 z-50 flex h-[50px] w-full gap-4 self-end overflow-hidden border-t border-darkHover bg-dark p-2 md:static md:h-full md:w-[50px] md:min-w-[50px] md:flex-col md:border-r md:border-t-0 md:p-2 md:pt-4",{hidden:l}),children:[e.jsx(ye,{viewName:W.FILES,icon:n[W.FILES]}),e.jsx(ye,{viewName:W.CHATS,icon:n[W.CHATS]}),e.jsx(ye,{viewName:W.COPILOT,icon:n[W.COPILOT]}),e.jsx(ye,{viewName:W.RUN,icon:n[W.RUN]}),e.jsx(ye,{viewName:W.CLIENTS,icon:n[W.CLIENTS]}),e.jsx(ye,{viewName:W.SETTINGS,icon:n[W.SETTINGS]}),e.jsx("div",{className:"flex h-fit items-center justify-center",children:e.jsx(hn,{roomId:p||"",username:c.username||""})}),e.jsxs("div",{className:"flex h-fit items-center justify-center",children:[e.jsx("button",{className:"flex items-center justify-center rounded p-1.5 transition-colors duration-200 ease-in-out hover:bg-[#3D404A]",onClick:()=>y(!0),onMouseEnter:()=>g(!0),"data-tooltip-id":"terminal-tooltip","data-tooltip-content":"Open Terminal",children:e.jsx(Je,{size:24,className:"text-green-400"})}),f&&e.jsx(De,{id:"terminal-tooltip",place:"right",offset:15,className:"!z-50",style:Ie,noArrow:!1,positionStrategy:"fixed",float:!0})]}),e.jsxs("div",{className:"flex h-fit items-center justify-center",children:[e.jsx("button",{className:"flex items-center justify-center rounded p-1.5 transition-colors duration-200 ease-in-out hover:bg-[#3D404A]",onClick:Y,onMouseEnter:()=>g(!0),"data-tooltip-id":"activity-state-tooltip","data-tooltip-content":d===le.CODING?"Switch to Drawing Mode":"Switch to Coding Mode",children:d===le.CODING?e.jsx(os,{size:30}):e.jsx(ns,{size:30})}),f&&e.jsx(De,{id:"activity-state-tooltip",place:"right",offset:15,className:"!z-50",style:Ie,noArrow:!1,positionStrategy:"fixed",float:!0})]})]}),e.jsx("div",{className:"absolute left-0 top-0 z-20 w-full flex-col bg-dark md:static md:min-w-[300px]",style:s?{}:{display:"none"},children:o[t]})]}),i&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm",children:e.jsxs("div",{className:"flex h-[600px] w-[800px] flex-col overflow-hidden rounded-lg border border-gray-700 bg-[#0C0C0C] shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between bg-[#2D2D2D] px-4 py-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Je,{className:"text-green-400",size:16}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Command Prompt"})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{className:"flex h-6 w-6 items-center justify-center rounded hover:bg-[#3D3D3D]",onClick:V,children:e.jsx("span",{className:"text-xs text-white",children:"ðŸ—‘ï¸"})}),e.jsx("button",{className:"flex h-6 w-6 items-center justify-center rounded hover:bg-[#3D3D3D]",onClick:()=>y(!1),children:e.jsx("span",{className:"text-xs text-white",children:"âœ•"})})]})]}),e.jsxs("div",{className:"flex space-x-2 bg-[#1E1E1E] px-4 py-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:"Quick install:"}),e.jsx("button",{onClick:()=>O("numpy"),className:"rounded bg-blue-600 px-2 py-1 text-xs text-white hover:bg-blue-700",children:"numpy"}),e.jsx("button",{onClick:()=>O("pandas"),className:"rounded bg-blue-600 px-2 py-1 text-xs text-white hover:bg-blue-700",children:"pandas"}),e.jsx("button",{onClick:()=>O("matplotlib"),className:"rounded bg-blue-600 px-2 py-1 text-xs text-white hover:bg-blue-700",children:"matplotlib"}),e.jsx("button",{onClick:()=>O("requests"),className:"rounded bg-blue-600 px-2 py-1 text-xs text-white hover:bg-blue-700",children:"requests"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-[#0C0C0C] p-4 font-mono text-sm",children:[e.jsxs("div",{className:"text-green-400",children:["Windows Terminal [Version 1.0.0]",e.jsx("br",{}),"(c) Code Editor Cloud. All rights reserved.",e.jsx("br",{}),e.jsx("br",{}),"Type 'pip list' to see installed packages",e.jsx("br",{}),"Type 'venv-info' for virtual environment info",e.jsx("br",{}),e.jsx("br",{})]}),e.jsx("pre",{className:"whitespace-pre-wrap break-words text-gray-200",children:k||`Welcome to Code Editor Cloud Terminal
`}),A&&e.jsxs("div",{className:"flex items-center space-x-2 text-yellow-400",children:[e.jsx("div",{className:"h-2 w-2 animate-ping rounded-full bg-yellow-400"}),e.jsx("span",{children:"Executing command..."})]})]}),e.jsxs("div",{className:"border-t border-gray-700 bg-[#0C0C0C] p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-green-400",children:"$"}),e.jsx("input",{type:"text",value:v,onChange:E=>R(E.target.value),onKeyPress:$,placeholder:"Enter command...",className:"flex-1 bg-transparent font-mono text-sm text-white outline-none placeholder:text-gray-500",disabled:A,autoFocus:!0}),e.jsx("button",{onClick:z,disabled:A||!v.trim(),className:"rounded bg-green-600 px-3 py-1 text-xs text-white hover:bg-green-700 disabled:bg-gray-600 disabled:text-gray-400",children:A?"Running...":"Run"})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"Available commands: pip install, pip list, python --version, venv-info, check <package>"})]})]})})]})}function gn(){const{isMobile:t}=fe();return e.jsx(co,{inferDarkMode:!0,forceMobile:t,defaultName:"Editor",className:"z-0",children:e.jsx(bn,{})})}function bn(){const t=lo(),{drawingData:s,setDrawingData:o}=Q(),{socket:n}=K(),a=r.useCallback(d=>{const u=d.changes;o(t.store.getSnapshot()),n.emit(h.DRAWING_UPDATE,{snapshot:u})},[t.store,o,n]),l=r.useCallback(({snapshot:d})=>{t.store.mergeRemoteChanges(()=>{const{added:u,updated:c,removed:p}=d;for(const x of Object.values(u))t.store.put([x]);for(const[,x]of Object.values(c))t.store.put([x]);for(const x of Object.values(p))t.store.remove([x.id])}),o(t.store.getSnapshot())},[t.store,o]);return r.useEffect(()=>{s&&Object.keys(s).length>0&&t.store.loadSnapshot(s)},[]),r.useEffect(()=>{const d=t.store.listen(a,{source:"user",scope:"document"});return n.on(h.DRAWING_UPDATE,l),()=>{d(),n.off(h.DRAWING_UPDATE)}},[s,t.store,a,l,n]),null}function yn(){const{fontSize:t,setFontSize:s}=Ne();r.useEffect(()=>{const o=n=>{const a="Changes you made may not be saved";return n.returnValue=a};return window.addEventListener("beforeunload",o),()=>{window.removeEventListener("beforeunload",o)}},[]),r.useEffect(()=>{const o=n=>{if(n.ctrlKey){if(n.preventDefault(),!n.target.closest(".cm-editor"))return;n.deltaY>0?s(Math.max(t-1,12)):s(Math.min(t+1,24))}};return window.addEventListener("wheel",o,{passive:!1}),()=>{window.removeEventListener("wheel",o)}},[t,s])}const jt=uo.define();function Ct(t){const s=["#FF0000","#008080","#0000FF","#008000","#FFD700","#800080","#00CED1","#FFA500","#9932CC","#1E90FF"];let o=0;for(let n=0;n<t.length;n++)o=t.charCodeAt(n)+((o<<5)-o);return s[Math.abs(o)%s.length]}class wn extends fo{constructor(s){super(),this.user=s}eq(s){return this.user.username===s.user.username&&this.user.typing===s.user.typing}toDOM(){const s=Ct(this.user.username),o=document.createElement("span");o.className="cm-remote-cursor",o.style.cssText=`
            position: absolute;
            width: 2px;
            height: 1.2em;
            background-color: ${s};
            border-radius: 1px;
            pointer-events: none;
            z-index: 10;
            animation: cursor-blink 1s infinite;
        `;const n=document.createElement("span");return n.className="cm-remote-cursor-label",n.textContent=this.user.username,n.style.cssText=`
            position: absolute;
            top: -20px;
            left: 0;
            background-color: ${s};
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 500;
            white-space: nowrap;
            pointer-events: none;
            z-index: 11;
            opacity: ${this.user.typing?"1":"0.7"};
            transition: opacity 0.3s ease;
        `,o.appendChild(n),o}}function En(t,s){return Oe.widget({widget:new wn(t),side:1}).range(s)}function vn(t,s,o){const n=Ct(t.username);return Oe.mark({class:"cm-remote-selection",attributes:{style:`
                background-color: ${n}33;
                border-left: 2px solid ${n};
                border-radius: 2px;
            `}}).range(s,o)}const Nn=mo.define({create(){return Oe.none},update(t,s){t=t.map(s.changes);for(const o of s.effects)if(o.is(jt)){const n=o.value,a=[];for(const l of n)if(!(!l.typing&&!l.selectionStart&&!l.selectionEnd)){if(l.selectionStart!==void 0&&l.selectionEnd!==void 0&&l.selectionStart!==l.selectionEnd){const d=Math.min(l.selectionStart,s.newDoc.length),u=Math.min(l.selectionEnd,s.newDoc.length);d<u&&a.push(vn(l,d,u))}if(l.cursorPosition>=0){const d=Math.min(l.cursorPosition,s.newDoc.length);a.push(En(l,d))}}return a.sort((l,d)=>{var x,m,f,g;const u=l.from-d.from;if(u!==0)return u;const c=((m=(x=l.value)==null?void 0:x.spec)==null?void 0:m.startSide)||0,p=((g=(f=d.value)==null?void 0:f.spec)==null?void 0:g.startSide)||0;return c-p}),Oe.set(a,!0)}return t},provide:t=>Me.decorations.from(t)}),jn=Me.baseTheme({".cm-remote-cursor":{position:"relative",display:"inline-block"},".cm-remote-selection":{position:"relative"},"@keyframes cursor-blink":{"0%, 50%":{opacity:"1"},"51%, 100%":{opacity:"0"}}});function Cn(){return[Nn,jn]}const _e={php:"php",phtml:"php",php3:"php",php4:"php",php5:"php",php7:"php",phps:"php",cs:"csharp",csx:"csharp",js:"javascript",jsx:"javascript",mjs:"javascript",cjs:"javascript",ts:"typescript",tsx:"typescript",mts:"typescript",cts:"typescript",java:"java",jsp:"java",py:"python",pyw:"python",pyi:"python",pyx:"python",c:"c",h:"c",cpp:"cpp",cxx:"cpp",cc:"cpp",hpp:"cpp",hxx:"cpp",hh:"cpp",html:"html",htm:"html",xhtml:"html",css:"css",scss:"scss",sass:"sass",less:"less",md:"markdown",markdown:"markdown",mdx:"markdown",json:"json",xml:"xml",xsd:"xml",xsl:"xml",xslt:"xml",yaml:"yaml",yml:"yaml",sql:"sql",sh:"shell",bash:"shell",zsh:"shell",fish:"shell",ps1:"powershell",psm1:"powershell",psd1:"powershell",rb:"ruby",rbx:"ruby",rjs:"ruby",rake:"ruby",go:"go",rs:"rust",swift:"swift",kt:"kotlin",kts:"kotlin",scala:"scala",sc:"scala",dart:"dart",lua:"lua",pl:"perl",pm:"perl",t:"perl",r:"r",R:"r",m:"objectivec",mm:"objectivec",vue:"vue",svelte:"svelte",component:"typescript",env:"shell",gitignore:"shell",dockerignore:"shell",editorconfig:"shell",dockerfile:"dockerfile",mk:"makefile",make:"makefile",makefile:"makefile",txt:"text",text:"text",csv:"csv",tsv:"tsv",log:"text",ini:"ini",cfg:"ini",conf:"ini",toml:"toml",graphql:"graphql",gql:"graphql",prisma:"prisma",proto:"protobuf",tex:"latex",sty:"latex",cls:"latex",bib:"bibtex",matlab:"matlab",ino:"arduino",asm:"assembly",s:"assembly",S:"assembly",f:"fortran",for:"fortran",f90:"fortran",f95:"fortran",hs:"haskell",lhs:"haskell",ex:"elixir",exs:"elixir",erl:"erlang",hrl:"erlang",clj:"clojure",cljs:"clojure",cljc:"clojure",groovy:"groovy",gvy:"groovy",gy:"groovy",gsh:"groovy",jl:"julia",pas:"pascal",p:"pascal",pro:"prolog",vhd:"vhdl",vhdl:"vhdl",v:"verilog",sv:"verilog",cob:"cobol",cbl:"cobol"};function Rn(){const{users:t,currentUser:s}=Q(),{activeFile:o,setActiveFile:n}=ce(),{theme:a,language:l,fontSize:d}=Ne(),{socket:u}=K(),{viewHeight:c}=se(),[p,x]=r.useState(setTimeout(()=>{},0)),m=r.useMemo(()=>t.filter(O=>O.username!==s.username),[t,s]),[f,g]=r.useState([]),i=r.useRef(null),[y,v]=r.useState(0),[R,k]=r.useState({}),j=r.useRef(null),A={javascript:()=>Re({jsx:!0,typescript:!1}),typescript:()=>Re({jsx:!0,typescript:!0}),jsx:()=>Re({jsx:!0,typescript:!1}),tsx:()=>Re({jsx:!0,typescript:!0}),html:()=>Co(),css:()=>Ce(),scss:()=>Ce(),sass:()=>Ce(),less:()=>Ce(),python:()=>jo(),java:()=>No(),php:()=>vo(),c:()=>Ye(),cpp:()=>Ye(),rust:()=>Eo(),go:()=>wo(),json:()=>yo(),xml:()=>bo(),yaml:()=>go(),markdown:()=>xo(),sql:()=>ho()},H=r.useCallback(O=>{if(!O)return null;const E=O.toLowerCase().slice(O.lastIndexOf(".")+1);return _e[E]||null},[]),Y=r.useCallback(O=>{if(!O)return null;const E=O.toLowerCase().trim();return _e[E]||null},[]),z=r.useMemo(()=>{if(o!=null&&o.name){const O=H(o.name);if(O)return O}if(l){const O=Y(l);if(O)return O}return null},[o==null?void 0:o.name,l,H,Y]),$=(O,E)=>{var ee,ne;if(!o)return;const w={...o,content:O};n(w);const I=(ne=(ee=E.state)==null?void 0:ee.selection)==null?void 0:ne.main,J=(I==null?void 0:I.head)||0,M=I==null?void 0:I.from,X=I==null?void 0:I.to;u.emit(h.TYPING_START,{cursorPosition:J,selectionStart:M,selectionEnd:X}),u.emit(h.FILE_UPDATED,{fileId:o.id,newContent:O}),clearTimeout(p);const oe=setTimeout(()=>u.emit(h.TYPING_PAUSE),1e3);x(oe)},V=r.useCallback(O=>{var oe,ee;if(!O.selectionSet)return;const E=(ee=(oe=O.state)==null?void 0:oe.selection)==null?void 0:ee.main,w=(E==null?void 0:E.head)||0,I=E==null?void 0:E.from,J=E==null?void 0:E.to,M=w!==y,X=I!==R.start||J!==R.end;(M||X)&&(v(w),k({start:I,end:J}),j.current!==null&&window.clearTimeout(j.current),j.current=window.setTimeout(()=>{u.emit(h.CURSOR_MOVE,{cursorPosition:w,selectionStart:I,selectionEnd:J})},100))},[y,R,u]);return r.useEffect(()=>()=>{j.current!==null&&window.clearTimeout(j.current),clearTimeout(p)},[p]),yn(),r.useEffect(()=>{const O=[oo,no,Cn(),Me.updateListener.of(V),po()];let E=null;if(z&&A[z])try{E=A[z](),console.log(`Loaded enhanced syntax highlighting for: ${z}`)}catch(w){console.warn(`Failed to load enhanced language ${z}:`,w)}if(!E&&z)try{E=ro(z),console.log(`Loaded basic syntax highlighting for: ${z}`)}catch(w){console.warn(`Failed to load basic language ${z}:`,w)}E?g([...O,E]):(z&&(console.warn(`No syntax highlighting available for: ${z}`),U.error(`Syntax highlighting is unavailable for "${z}". Using plain text mode.`,{duration:4e3,icon:"âš ï¸"})),g(O))},[z,l,m,V]),r.useEffect(()=>{var O;(O=i.current)!=null&&O.view&&i.current.view.dispatch({effects:jt.of(m)})},[m]),e.jsx(ao,{ref:i,theme:vt[a],onChange:$,value:o==null?void 0:o.content,extensions:f,minHeight:"100%",maxWidth:"100vw",style:{fontSize:d+"px",height:c,position:"relative"}})}function Sn(){const{openFiles:t,closeFile:s,activeFile:o,updateFileContent:n,setActiveFile:a}=ce(),l=r.useRef(null),{setLanguage:d}=Ne(),u=c=>{if((o==null?void 0:o.id)===c)return;n((o==null?void 0:o.id)||"",(o==null?void 0:o.content)||"");const p=t.find(x=>x.id===c);p&&a(p)};return r.useEffect(()=>{const c=l.current;if(!c)return;const p=x=>{x.deltaY>0?c.scrollLeft+=100:c.scrollLeft-=100};return c.addEventListener("wheel",p),()=>{c.removeEventListener("wheel",p)}},[]),r.useEffect(()=>{if((o==null?void 0:o.name)===void 0)return;const c=o.name.split(".").pop();if(!c)return;if(_e[c]){d(_e[c]);return}const p=at.languages(c);d(p[0])},[o==null?void 0:o.name,d]),e.jsx("div",{className:"flex h-[50px] w-full select-none gap-2 overflow-x-auto p-2 pb-0",ref:l,children:t.map(c=>e.jsxs("span",{className:we("flex w-fit cursor-pointer items-center rounded-t-md px-2 py-1 text-white",{"bg-darkHover":c.id===(o==null?void 0:o.id)}),onClick:()=>u(c.id),children:[e.jsx(rt,{icon:bt(c.name),fontSize:22,className:"mr-2 min-w-fit"}),e.jsx("p",{className:"flex-grow cursor-pointer overflow-hidden truncate",title:c.name,children:c.name}),e.jsx(rs,{className:"ml-3 inline rounded-md hover:bg-darkHover",size:20,onClick:()=>s(c.id)})]},c.id))})}function Dn(){const{openFiles:t}=ce(),{minHeightReached:s}=se();return t.length<=0?e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx("h1",{className:"text-xl text-white",children:"No file is currently open."})}):e.jsxs("main",{className:we("flex w-full flex-col overflow-x-auto md:h-screen",{"h-[calc(100vh-50px)]":!s,"h-full":s}),children:[e.jsx(Sn,{}),e.jsx(Rn,{})]})}function On(){const{viewHeight:t}=se(),{activityState:s}=Q();return e.jsx("div",{className:"absolute left-0 top-0 w-full max-w-full flex-grow overflow-x-hidden md:static",style:{height:t},children:s===le.DRAWING?e.jsx(gn,{}):e.jsx(Dn,{})})}function In(){function t(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(n=>navigator.userAgent.match(n))}const s=t();r.useEffect(()=>{s&&qe.isEnabled&&qe.request()},[s])}function _n(){const{setUsers:t}=Q(),{socket:s}=K(),o=r.useCallback(()=>{document.visibilityState==="visible"?s.emit(h.USER_ONLINE,{socketId:s.id}):document.visibilityState==="hidden"&&s.emit(h.USER_OFFLINE,{socketId:s.id})},[s]),n=r.useCallback(({socketId:d})=>{t(u=>u.map(c=>c.socketId===d?{...c,status:ve.ONLINE}:c))},[t]),a=r.useCallback(({socketId:d})=>{t(u=>u.map(c=>c.socketId===d?{...c,status:ve.OFFLINE}:c))},[t]),l=r.useCallback(({user:d})=>{t(u=>u.map(c=>c.socketId===d.socketId?d:c))},[t]);r.useEffect(()=>(document.addEventListener("visibilitychange",o),s.on(h.USER_ONLINE,n),s.on(h.USER_OFFLINE,a),s.on(h.TYPING_START,l),s.on(h.TYPING_PAUSE,l),s.on(h.CURSOR_MOVE,l),()=>{document.removeEventListener("visibilitychange",o),s.off(h.USER_ONLINE),s.off(h.USER_OFFLINE),s.off(h.TYPING_START),s.off(h.TYPING_PAUSE),s.off(h.CURSOR_MOVE)}),[s,t,o,n,a,l])}function kn(){var u;_n(),In();const t=ke(),{roomId:s}=ot(),{status:o,setCurrentUser:n,currentUser:a}=Q(),{socket:l}=K(),d=nt();return r.useEffect(()=>{var p;if(a.username.length>0)return;const c=(p=d.state)==null?void 0:p.username;if(c===void 0)t("/",{state:{roomId:s}});else if(s){const x={username:c,roomId:s};n(x),l.emit(h.JOIN_REQUEST,x)}},[a.username,(u=d.state)==null?void 0:u.username,t,s,n,l]),o===F.CONNECTION_FAILED?e.jsx(mn,{}):e.jsxs(un,{children:[e.jsx(xn,{}),e.jsx(On,{})]})}const Tn="/assets/illustration-Azuc-YCm.svg",An="/assets/logo-eD4nMjT1.svg",Xe=()=>e.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),Ze=()=>e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}),Se=(t,s,o)=>{let n="";if(o){const a=new Date;a.setTime(a.getTime()+o*24*60*60*1e3),n="; expires="+a.toUTCString()}document.cookie=t+"="+s+n+"; path=/; SameSite=Lax"},ie=t=>{const s=t+"=",o=document.cookie.split(";");for(let n=0;n<o.length;n++){let a=o[n];for(;a.charAt(0)===" ";)a=a.substring(1,a.length);if(a.indexOf(s)===0)return a.substring(s.length,a.length)}return""},ue=t=>{document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"},et={PERSISTENT:365},Ln=()=>{var G,de;const t=nt(),{currentUser:s,setCurrentUser:o,status:n,setStatus:a}=Q(),{socket:l}=K(),[d,u]=r.useState(!1),[c,p]=r.useState(""),[x,m]=r.useState(!1),[f,g]=r.useState(!1),[i,y]=r.useState(null),[v,R]=r.useState(!1),[k,j]=r.useState(""),[A,H]=r.useState(!1),[Y,z]=r.useState(!1),[$,V]=r.useState(!1),[O,E]=r.useState(et.PERSISTENT),[w,I]=r.useState(null),J=r.useRef(null),M=r.useRef(null),X=ke();r.useEffect(()=>{const P=ie("savedUsername"),B=ie("savedRoomId"),Z=ie("rememberMe")==="true",be=ie("cookieLifetime");if(Z&&P&&B&&(o({...s,username:P,roomId:B}),m(!0),be)){const je=be==="session"?void 0:parseInt(be);E(je)}},[o]),r.useEffect(()=>{if($||n===F.ATTEMPTING_JOIN||n===F.JOINED)return;const P=ie("savedUsername"),B=ie("savedRoomId");ie("rememberMe")==="true"&&P&&B&&s.username===P&&s.roomId===B&&s.username.trim().length>=3&&s.roomId.trim().length>=5&&(V(!0),setTimeout(()=>{S()},100))},[s,n,$]);const oe=()=>{var B;const P=te();o({...s,roomId:P}),u(!0),y(null),I(null),_.success("Created a new Room ID"),(B=J.current)==null||B.focus()},ee=P=>{const B=P.target.name,Z=P.target.value;o({...s,[B]:Z}),B==="roomId"&&I(null)},ne=P=>{p(P.target.value)},pe=P=>{const B=P.target.checked;m(B),B||E(et.PERSISTENT)},he=P=>{const B=P.target.value;let Z;B==="session"?Z=void 0:Z=parseInt(B),E(Z),x&&s.username&&s.roomId&&me(Z)},me=P=>{Se("savedUsername",s.username,P),Se("savedRoomId",s.roomId,P),Se("rememberMe","true",P),Se("cookieLifetime",P?P.toString():"session",P)},xe=()=>{H(!A)},L=()=>{z(!Y)},re=()=>s.username.trim().length===0?(_.error("Enter your username"),!1):s.roomId.trim().length===0?(_.error("Enter a room ID"),!1):s.roomId.trim().length<5?(_.error("Room ID must be at least 5 characters long"),!1):s.username.trim().length<3?(_.error("Username must be at least 3 characters long"),!1):!0;r.useEffect(()=>{s.roomId.trim().length>=5?b():(y(null),u(!1))},[s.roomId]);const b=async()=>{s.roomId.trim().length<5||(R(!0),l.emit(h.ROOM_INFO_REQUEST,{roomId:s.roomId}))},N=()=>{if(!c.trim()){_.error("Please enter room password");return}j(c),l.emit(h.CHECK_ROOM_PASSWORD,{roomId:s.roomId,password:c})},S=()=>{n===F.ATTEMPTING_JOIN||n===F.JOINED||(console.log("Auto-joining room with saved credentials..."),D())},C=P=>{if(P.preventDefault(),!(n===F.ATTEMPTING_JOIN||n===F.JOINED)&&re()){if(I(s.roomId),x?(me(O),_.success(`Credentials saved ${O?`for ${O} days`:"for this session"}`)):(ue("savedUsername"),ue("savedRoomId"),ue("rememberMe"),ue("cookieLifetime")),i){if(i.is_delete&&i.owner_name!==s.username){_.error("Room has been deleted");return}if(!i.is_active&&i.owner_name!==s.username){_.error("Room is inactive");return}if(n===F.BANNED){_.error("You are banned from this room");return}if(i.has_password&&!d){if(i.owner_name===s.username){D();return}g(!0);return}}D()}},D=P=>{_.loading(d?"Creating room...":"Joining room..."),a(F.ATTEMPTING_JOIN);const B=P||k||(d?c:""),Z={roomId:s.roomId,username:s.username,password:B,roomName:d?`${s.username}'s Room`:"Collaborative Room"};console.log("Sending JOIN_REQUEST with password:",B?"***":"empty"),l.emit(h.JOIN_REQUEST,Z),u(!1)};r.useEffect(()=>{const P=q=>{R(!1),y(q.roomInfo),u(!1)},B=q=>{g(!1),_.success("Password verified!"),console.log("Verified room:",q.roomId),D(c)},Z=()=>{var q;_.error("Incorrect password"),p(""),j(""),(q=M.current)==null||q.focus()},be=()=>{g(!0)},je=q=>{R(!1),_.dismiss(),q.message==="Room not found"?(y(null),s.roomId.trim().length>=5&&u(!0)):q.message.includes("deleted")||q.message.includes("inactive")?i&&i.owner_name===s.username?(_.loading("Reactivating room as owner..."),setTimeout(()=>{D()},1e3)):(a(F.DISCONNECTED),y(null),u(!1),I(null),_.error(q.message)):q.message.includes("banned")?(a(F.DISCONNECTED),I(null),_.error(q.message)):(a(F.DISCONNECTED),I(null),_.error(q.message))},He=q=>{a(F.JOINED),_.dismiss(),_.success("Successfully joined room!"),j(""),p(""),I(null),console.log("Joined room:",q)},ze=()=>{a(F.DISCONNECTED),_.dismiss(),_.error("Username already exists in this room"),V(!1),I(null)},Ge=q=>{a(F.JOINED),_.dismiss(),_.success("Room created successfully!"),p(""),I(null),console.log("Room created:",q)},We=q=>{a(F.DISCONNECTED),_.dismiss(),_.loading(q.message,{duration:5e3}),I(null)};return l.on(h.ROOM_INFO_RESPONSE,P),l.on(h.PASSWORD_VALID,B),l.on(h.PASSWORD_INCORRECT,Z),l.on(h.PASSWORD_REQUIRED,be),l.on(h.ERROR,je),l.on(h.JOIN_ACCEPTED,He),l.on(h.USERNAME_EXISTS,ze),l.on(h.ROOM_CREATED,Ge),l.on(h.JOIN_PENDING,We),()=>{l.off(h.ROOM_INFO_RESPONSE,P),l.off(h.PASSWORD_VALID,B),l.off(h.PASSWORD_INCORRECT,Z),l.off(h.PASSWORD_REQUIRED,be),l.off(h.ERROR,je),l.off(h.JOIN_ACCEPTED,He),l.off(h.USERNAME_EXISTS,ze),l.off(h.ROOM_CREATED,Ge),l.off(h.JOIN_PENDING,We)}},[l,s.roomId,c]),r.useEffect(()=>{var P;s.roomId.length>0||(P=t.state)!=null&&P.roomId&&(o({...s,roomId:t.state.roomId}),s.username.length===0&&_.success("Enter your username"))},[s,(G=t.state)==null?void 0:G.roomId,o]),r.useEffect(()=>{if(n===F.DISCONNECTED&&!l.connected){l.connect();return}const P=sessionStorage.getItem("redirect")||!1;if(n===F.JOINED&&!P){const B=s.username;sessionStorage.setItem("redirect","true"),X(`/editor/${s.roomId}`,{state:{username:B}})}else n===F.JOINED&&P&&(sessionStorage.removeItem("redirect"),a(F.DISCONNECTED),l.disconnect(),l.connect())},[s,(de=t.state)==null?void 0:de.redirect,X,a,l,n]);const T=()=>x?O===void 0?" (Session)":O===1?" (1 day)":O===7?" (1 week)":O===30?" (1 month)":O===365?" (1 year)":` (${O} days)`:"",ge=w===s.roomId&&n===F.ATTEMPTING_JOIN;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex w-full max-w-[500px] flex-col items-center justify-center gap-4 p-4 sm:w-[500px] sm:p-8",children:[e.jsx("img",{src:An,alt:"Logo",className:"w-full"}),x&&ie("savedUsername")&&ie("savedRoomId")&&e.jsxs("div",{className:"flex w-full items-center gap-2 rounded-md bg-blue-500/20 p-2 text-sm text-blue-400",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"Auto-login enabled with saved credentials",T()]}),s.roomId.length>=5&&e.jsx("div",{className:"w-full rounded-md bg-darkHover p-3 text-sm",children:v?e.jsxs("div",{className:"flex items-center gap-2 text-yellow-400",children:[e.jsx("div",{className:"h-2 w-2 animate-ping rounded-full bg-yellow-400"}),"Checking room..."]}):i?e.jsxs("div",{className:i.is_delete||!i.is_active?"text-red-400":"text-green-400",children:[i.is_delete?e.jsxs(e.Fragment,{children:["âŒ Room has been deleted",i.owner_name===s.username&&e.jsx("div",{className:"text-xs text-yellow-400 mt-1",children:"You are the owner - you can reactivate this room by joining"})]}):i.is_active?e.jsxs(e.Fragment,{children:["âœ“ Room found: ",i.room_name,i.has_password?e.jsx("div",{className:"text-xs text-yellow-400 mt-1",children:"ðŸ”’ Password protected - approval required for first time"}):e.jsx("div",{className:"text-xs text-green-400 mt-1",children:"ðŸ”“ No password - immediate access"})]}):e.jsxs(e.Fragment,{children:["â¸ï¸ Room is inactive",i.owner_name===s.username&&e.jsx("div",{className:"text-xs text-yellow-400 mt-1",children:"You are the owner - you can reactivate this room by joining"})]}),i.owner_name&&` (Created by ${i.owner_name})`,i.owner_name===s.username&&e.jsx("div",{className:"text-xs text-blue-400 mt-1",children:"ðŸ‘‘ You are the room owner"}),e.jsxs("div",{className:"text-xs text-gray-400",children:[i.user_count," user(s) online"]}),(i.is_delete||!i.is_active)&&i.owner_name!==s.username&&e.jsx("div",{className:"text-xs text-yellow-400 mt-1",children:"You can create a new room or join another one"})]}):d?e.jsx("div",{className:"text-blue-400",children:"ðŸ†• New room will be created"}):e.jsx("div",{className:"text-gray-400",children:"Enter a Room ID to check availability"})}),e.jsxs("form",{onSubmit:C,className:"flex w-full flex-col gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"roomId",placeholder:"Room ID",className:"w-full rounded-md border border-gray-500 bg-darkHover px-3 py-3 focus:outline-none disabled:opacity-50",onChange:ee,value:s.roomId,disabled:n===F.JOINED}),d&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx("span",{className:"rounded bg-blue-500 px-2 py-1 text-xs text-white",children:"NEW"})})]}),e.jsx("input",{type:"text",name:"username",placeholder:"Username",className:"w-full rounded-md border border-gray-500 bg-darkHover px-3 py-3 focus:outline-none disabled:opacity-50",onChange:ee,value:s.username,ref:J,disabled:n===F.JOINED}),d&&e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:A?"text":"password",placeholder:"Room Password (optional)",className:"w-full rounded-md border border-gray-500 bg-darkHover px-3 py-3 pr-10 focus:outline-none disabled:opacity-50",value:c,onChange:ne,disabled:n===F.JOINED}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-300",onClick:xe,children:A?e.jsx(Ze,{}):e.jsx(Xe,{})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"rememberMe",checked:x,onChange:pe,className:"h-4 w-4 rounded border-gray-500 bg-darkHover text-primary focus:ring-primary",disabled:n===F.JOINED}),e.jsx("label",{htmlFor:"rememberMe",className:"text-sm text-gray-300",children:"Remember me"}),x&&e.jsx("svg",{className:"h-4 w-4 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})]}),x&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("select",{value:O===void 0?"session":O.toString(),onChange:he,className:"rounded-md border border-gray-500 bg-darkHover px-2 py-1 text-sm text-gray-300 focus:outline-none disabled:opacity-50",disabled:n===F.JOINED,children:[e.jsx("option",{value:"session",children:"This session only"}),e.jsx("option",{value:"1",children:"1 day"}),e.jsx("option",{value:"7",children:"1 week"}),e.jsx("option",{value:"30",children:"1 month"}),e.jsx("option",{value:"365",children:"1 year"})]})]})]}),e.jsx("button",{type:"submit",className:"mt-2 flex items-center justify-center gap-2 w-full rounded-md bg-primary px-8 py-3 text-lg font-semibold text-black disabled:opacity-50",disabled:ge||n===F.JOINED,children:ge?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"h-5 w-5 animate-spin",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),d?"Creating...":"Joining..."]}):n===F.JOINED?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-5 w-5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Joined Successfully"]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),d?"Create Room":"Join Room"]})})]}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsxs("button",{className:"flex items-center gap-2 cursor-pointer select-none underline disabled:opacity-50",onClick:oe,disabled:n===F.JOINED,children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Generate Unique Room ID"]}),ie("rememberMe")==="true"&&e.jsxs("button",{className:"flex items-center gap-1 cursor-pointer select-none text-sm text-red-400 underline disabled:opacity-50",onClick:()=>{ue("savedUsername"),ue("savedRoomId"),ue("rememberMe"),ue("cookieLifetime"),m(!1),o({...s,username:"",roomId:""}),V(!1),I(null),_.success("Saved credentials cleared")},disabled:n===F.JOINED,children:[e.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Clear saved"]})]})]}),f&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"w-full max-w-md rounded-lg bg-dark p-6 shadow-xl",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold",children:"Room Password Required"}),e.jsx("p",{className:"mb-4 text-sm text-gray-300",children:"This room is protected with a password. Please enter the password to join."}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("input",{type:Y?"text":"password",placeholder:"Enter room password",className:"w-full rounded-md border border-gray-500 bg-darkHover px-3 py-3 pr-10 focus:outline-none",value:c,onChange:ne,ref:M,autoFocus:!0,onKeyDown:P=>{P.key==="Enter"&&N()}}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-300",onClick:L,children:Y?e.jsx(Ze,{}):e.jsx(Xe,{})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:N,className:"flex items-center justify-center gap-2 flex-1 rounded-md bg-primary px-4 py-2 font-semibold text-black",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),"Join Room"]}),e.jsxs("button",{onClick:()=>{g(!1),p(""),j(""),I(null)},className:"flex items-center justify-center gap-2 flex-1 rounded-md border border-gray-500 px-4 py-2 font-semibold",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Cancel"]})]})]})})]})};function Pn(){return e.jsx("div",{className:"flex min-h-screen flex-col items-center justify-center gap-16",children:e.jsxs("div",{className:"my-12 flex h-full min-w-full flex-col items-center justify-evenly sm:flex-row sm:pt-0",children:[e.jsx("div",{className:"flex w-full animate-up-down justify-center sm:w-1/2 sm:pl-4",children:e.jsx("img",{src:Tn,alt:"Code Editor Illustration",className:"mx-auto w-[250px] sm:w-[400px]"})}),e.jsx("div",{className:"flex w-full items-center justify-center sm:w-1/2",children:e.jsx(Ln,{})})]})})}const Fn=()=>e.jsxs(e.Fragment,{children:[e.jsx(Ot,{children:e.jsxs(as,{children:[e.jsx(Ve,{path:"/",element:e.jsx(Pn,{})}),e.jsx(Ve,{path:"/editor/:roomId",element:e.jsx(kn,{})})]})}),e.jsx(Do,{})," ",e.jsx(So,{})]});function Mn({children:t}){return e.jsx(Oo,{children:e.jsx(_o,{children:e.jsx(Ro,{children:e.jsx(dn,{children:e.jsx(Wo,{children:e.jsx(Ho,{children:e.jsx(en,{children:e.jsx(ko,{children:t})})})})})})})})}Dt.createRoot(document.getElementById("root")).render(e.jsx(Mn,{children:e.jsx(Fn,{})}));
